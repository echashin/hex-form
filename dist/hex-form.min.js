"use strict";this.HexWidget=function(){function t(t){return null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?!0:!1}function e(t){function e(t){void 0!==t.input&&(a=t.input,n=a.closest(".form-group").find("button.password-show"),n.bind("click",function(t){return t.preventDefault(),"password"===r?(a.attr("type","text"),n.addClass("active"),r="text"):(a.attr("type","password"),n.removeClass("active"),r="password"),a.focus(),!1}))}var n,a,r="password";e(t)}function n(t){function e(t){return s=t.length>8?1:0,u=t.match(v)?1:0,d=t.match(f)?1:0,l=t.match(p)?1:0,c=t.match(h)?1:0,s+u+d+l+c}function n(t){void 0!==t.events&&i.setEvents(t.events),void 0!==t.input&&(a=t.input,r=a.closest(".form-group").find(".password-strength div"),a.bind("keyup change",function(){var t=a.val();r.attr("class","s-"+e(t))}))}var a,r,i=this,o=["change"],s=0,u=0,d=0,l=0,c=0,v=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(t){o=t},i.getEvents=function(){return o},n(t)}function a(t){function e(t){if(void 0!==t.input){n=t.input;var e=moment.localeData(),a={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:e.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:e.firstDayOfWeek()}};$.extend(a,t);var r=a.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");a.singleDatePicker===!1&&(r+=a.locale.separator+r),n.inputmask(r),n.daterangepicker(a,function(t,e){var r=t.format(a.locale.format);a.singleDatePicker===!1&&(r+=a.locale.separator+e.format(a.locale.format)),n.val(r),n.trigger("blur")})}}var n;e(t)}function r(e){function n(e){if(void 0!==e.control&&(r=e.control),void 0!==e.input){a=e.input;var n=e.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:n};if(void 0!==e.url){i="ajax";var s=a.find("option[selected]");if(e.ajax={url:e.url,method:"POST",dataType:"json",delay:250,data:function(t){return{search:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.rows,pagination:{more:e.page*t.limit<t.total}}},cache:!1},delete e.url,void 0!==e.parent){var u=e.parent.selector,d=e.parent.param||"parent_id";t($(u).val())&&(r.disable(),a.val("").trigger("change")),$(u).on("change",function(){t($(this).val())?(r.disable(),a.val("").trigger("change")):r.enable()}),delete e.parent;var l=function(){return $(u).val()};e.ajax.data=function(t){var e={search:t.term,page:t.page};return e[d]=l,e}}}$.extend(o,e),a.select2(o),"ajax"===i&&(s.each(function(){a.append($(this))}),a.trigger("change"))}}var a,r,i="local";n(e)}function i(t){function e(t){function e(t){r=t.target.files[0],a.setValue(r)}n=t.input,a=t.control,n.bind("change",e)}var n,a,r;e(t)}function o(t){function e(t){n=t.input,n.inputmask(t.mask)}var n;e(t)}function s(t){function e(t){void 0!==t.input&&(n=t.input,n.inputmask("+7(999)999-99-99"))}var n;e(t)}function u(t){function u(t){switch(t.type){case"password-strength":return new n(t);case"password-show":return new e(t);case"date":return new a(t);case"phone":return new s(t);case"select2":return new r(t);case"mask":return new o(t);case"filesimple":return new i(t);default:throw new Error("Unfinded widget: "+t.type)}}return u(t)}return u}(),this.HexValidator=function(){function t(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a=["blur","change"];n.weight=0;var r="required";n.getClassName=function(){return r},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(t){return null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?!1:!0},e(t)}function e(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.input&&(r=t.input)}var n=this,a=["change","keyup","blur"];n.weight=3;var r,i="date";n.getClassName=function(){return i},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(t){if(""===t||void 0===t||t===!1)return!0;var e=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:e})},e(t)}function n(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a="email";n.getClassName=function(){return a};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return""===t||void 0===t||t===!1?!0:i.test(t)},e(t)}function a(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.url&&(r=t.url)}var n=this,a="unique";n.getClassName=function(){return a};var r,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(t){s=t},n.getEvents=function(){return s},n.isValid=function(t){if(o!==!1&&o.abort(),i!==t){o=$.ajax({url:r,data:{value:t},method:"POST",async:!1});var e=o.responseText;return i="true"===e?t:!1,e}return!0},e(t)}function r(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.input&&(n=t.input)}var n,a=this,r="phone",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(t){i=t},a.getEvents=function(){return i},a.isValid=function(){var t=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:t})},e(t)}function i(t){function e(t){void 0!==t.min&&(n=t.min),void 0!==t.max&&(a=t.max),void 0!==t.events&&r.setEvents(t.events)}var n,a,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(t){o=t},r.getEvents=function(){return o},r.isValid=function(t){var e=t.length;return void 0!==n&&n>e?(i="string-length-min",!1):void 0!==a&&e>a?(i="string-length-max",!1):!0},e(t)}function o(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.password&&(i=$(t.password))}var n=this,a="password-confirm";n.getClassName=function(){return a};var r=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return i.val()===t},e(t)}function s(s){function u(s){switch(s.type){case"required":return new t(s);case"email":return new n(s);case"unique":return new a(s);case"password-confirm":return new o(s);case"string-length":return new i(s);case"date":return new e(s);case"phone":return new r(s);default:throw new Error("Unfinded validator: "+s.type)}}return u(s)}return s}(),this.hexForm=function(){function t(t){var e=this;e.type=void 0,e.valid=!0,e.name=void 0;var n,a,r,i,o=[],s=t.form;e.tabPanelId=void 0;var u,d=[],l={},c={},v=!1;e.setValid=function(){r.removeClass("has-error"),a.find("span").removeClass("active")},e.enable=function(){for(var t in o)o[t].prop("disabled",!1);v=!1},e.disable=function(){for(var t in o)o[t].prop("disabled",!0);v=!0};var f=function(t){return function(e,n){return"number"==typeof e[t]?e[t]-n[t]:e[t]<n[t]?-1:e[t]>n[t]?1:0}},p=function(){var t=0;a.find("span").removeClass("active");for(var i in d)if(d.hasOwnProperty(i)){var o=d[i],u=e.getValue(),l=o.isValid(u);if(l===!1||"false"===l){t++,a.find("span.error-"+o.getClassName()).addClass("active");break}}if(t>0?(e.valid=!1,r.addClass("has-error")):(r.removeClass("has-error"),e.valid=!0),void 0!==n){var c=!0;for(var v in s.controls)if(s.controls.hasOwnProperty(v)){var f=s.controls[v];if(f.tabPanelId===e.tabPanelId&&f.valid===!1){c=!1;break}}c===!0?n.removeClass("has-error"):n.addClass("has-error")}return e.valid};e.validate=function(t){return void 0===t?p():"blur"===t.type?p():(void 0!==i&&clearTimeout(i),void(i=setTimeout(p,500)))},e.trigger=function(t){for(var e=0;e<o.length;e++)o[e].trigger(t)};var h=function(t){for(var e={},n=t[0].attributes,a=n.length,r=0;a>r;r++)e[n[r].name.toLowerCase()]=n[r].value;return e},m=function(t,e,n){var a={input:n,type:t};void 0!==e&&""!==e&&$.extend(a,jQuery.parseJSON(e));var r=new HexValidator(a),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(c[i[o]]=!0);d.push(r)},g=function(t,n,a){var r={input:a,type:t,control:e};void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),l[t]=new HexWidget(r)};e.addInput=function(t){o.push(t);var n=h(t);for(var a in n)if(n.hasOwnProperty(a)){if("required"===a)m("required",n[a],t);else{var r=a.match(/^data-hex-validator-(.*)$/i);null!==r&&void 0!==r[1]&&m(r[1],n[a],t)}var i=a.match(/^data-hex-widget-(.*)$/i);null!==i&&void 0!==i[1]&&g(i[1],n[a],t)}for(var s in c)c.hasOwnProperty(s)&&t.bind(s,e.validate);d.sort(f("weight"))},e.getValue=function(){switch(e.type){case"text":default:if(void 0!==l.date){var t=o[0].data("daterangepicker");if(void 0===t)return o[0].val();if(""===o[0].val())return!1;var n="";if(n+=t.startDate.format("YYYY-MM-DD"),t.singleDatePicker===!1){var a=t.endDate.format("YYYY-MM-DD");n+=" - "+a}return n}return void 0!==l.fileupload||void 0!==l.filesimple?u:o[0].val();case"radio":for(var r in o)if(o.hasOwnProperty(r)&&o[r].is(":checked")===!0)return o[r].val();return!1;case"checkbox":return o[0].is(":checked")===!0?e.trueValue:e.falseValue}},e.setValue=function(t){u=t};var w=function(t){if(void 0!==t.type&&(e.type=t.type,"checkbox"===t.type&&(e.trueValue=!0,e.falseValue=!1)),void 0!==t.form&&(s=t.form),e.name=t.name,void 0!==t.inputs)for(var i in t.inputs)t.inputs.hasOwnProperty(i)&&e.addInput(t.inputs[i]);r=o[0].closest("div.form-group"),a=r.find(".errors");var u=r.closest(".tab-pane");if(u.size()>0){var d=u.attr("id"),l=$('.nav a[href="#'+d+'"]');l.size()>0&&(n=l),e.tabPanelId=d}e.setValid()};w(t)}function e(e){function n(t,e){t.attr("data-hex-multy-item",e),t.find('input[type!="submit"],select,textarea').each(function(){$(this).val("");var t=$(this).attr("name");t=t.replace(/\[\d+\]/g,function(){return"["+e+"]"}),$(this).attr("name",t)})}function a(t){var e=t.find("[data-hex-multy-item]");e.size()<=1?t.find("[data-hex-multy-remove]").attr("disabled","disabled"):t.find("[data-hex-multy-remove]").removeAttr("disabled")}var r=this;r.controls={};var i=e,o={},s=function(t){this.type=t,this.stoped=!1,this.stop=function(){this.stoped=!0}};r.on=function(t,e){void 0===o[t]&&(o[t]=[]),o[t].push(e)},r.off=function(t,e){void 0!==o[t]&&o[t].splice(o[t].indexOf(e),1)},r.fire=function(t,e){var n=new s(t);if(void 0!==o[t])for(var a in o[t]){var r=o[t][a];r(e,n)}return!n.stoped};var u=function(t){$.each(t.find('input[type!="submit"],select,textarea'),function(t,e){var n=$(e),a=n.attr("name");void 0!==r.controls[a]&&delete r.controls[a]})},d=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,n){var a=$(n),i=a.attr("name"),o=a.prop("tagName").toLowerCase();switch(o){case"select":case"textarea":r.controls[i]=new t({type:o,inputs:[a],form:r,name:i});break;case"input":var s=a.attr("type").toLowerCase();switch(s){default:r.controls[i]=new t({type:s,inputs:[a],form:r,name:i});break;case"checkbox":var u=new t({type:"checkbox",inputs:[a],form:r,name:i});void 0!==a.attr("value")&&(u.trueValue=a.attr("value")),void 0!==a.attr("data-hex-true-value")&&(u.trueValue=a.attr("data-hex-true-value")),void 0!==a.attr("data-hex-false-value")&&(u.falseValue=a.attr("data-hex-false-value")),r.controls[i]=u;break;case"radio":void 0===r.controls[i]?r.controls[i]=new t({type:"radio",inputs:[a],form:r,name:i}):r.controls[i].addInput(a)}}})},l=function(){var t={};for(var e in r.controls)if(r.controls.hasOwnProperty(e)){var n=r.controls[e].name,a=r.controls[e].getValue();void 0===a&&(a=""),t[n]=a}return t},c=function(t){var e=r.fire("beforeReset",{values:r.getValues()});e?window.setTimeout(function(){for(var t in r.controls)r.controls.hasOwnProperty(t)&&r.controls[t].trigger("change")},1):t.preventDefault(),r.fire("afterReset",{})},v=function(){i.find(".has-error").removeClass("has-error"),i.find(".alerts div").remove()},f=function(t){t.preventDefault(),t.stopPropagation();var e=!0;for(var n in r.controls)r.controls.hasOwnProperty(n)&&r.controls[n].validate(void 0)===!1&&(e=!1);if(e===!0){v();var a=l(),o=r.fire("beforeSubmit",{values:a});if(o){r.loaderShow();var s=i.attr("action"),u=i.find("button[type=submit]:focus");u.size()>0&&void 0!==u.attr("data-action")&&(s=u.attr("data-action"));var d="POST";void 0!==i.attr("method")&&(d=i.attr("method"));var c=new FormData;$.each(a,function(t,e){if($.isArray(e)||$.isPlainObject(e))for(var n in e)c.append(t,e[n]);else c.append(t,e)}),console.log(a),console.log(c),$.ajax({url:s,data:c,type:d,dataType:"json",processData:!1,contentType:!1,success:function(t){if(r.loaderHide(),t.success===!0&&(v(),void 0!==t.reload&&(t.reload===!0?window.location.href=window.location.href:window.location.href=t.reload)),void 0!==t.alerts)for(var e in t.alerts){var n=t.alerts[e];i.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}},error:function(t,e,n){r.loaderHide()}})}}return!1};r.loaderShow=function(){i.find(".loader").show()},r.loaderHide=function(){i.find(".loader").hide()},r.submit=function(){f()},r.getValues=function(){return l()};var p=function(){i.addClass("loader-container").append('<div class="loader"></div>'),i.bind("submit",f),i.bind("reset",c),0===i.find(".loader").size()&&i.append('<div class="loader"></div>'),d(i),i.find("div[data-hex-multy]").size()>0&&i.find("div[data-hex-multy]").each(function(){a($(this))}),i.find("div[data-hex-multy]").on("click","button[data-hex-multy-add]",function(){var t=$(this).closest("div[data-hex-multy]"),e=t.find("[data-hex-multy-item]").last(),r=(parseInt(e.attr("data-hex-multy-item")),$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]")),i=r.size(),o=e.clone(!1);o.find("[data-hex-multy-hide]").remove(),o.find("[data-hex-multy-attr]").each(function(){var t=$(this),e=t.data("hex-multy-attr");if(void 0!==e.add&&$.each(e.add,function(e,n){for(var a in n)t.attr(a,n[a])}),void 0!==e.remove)for(var n in e.remove)t.removeAttr(e.remove[n])}),n(o,i),d(o),o.insertAfter(e),a(t)}),i.find("div[data-hex-multy]").on("click","button[data-hex-multy-remove]",function(){var t=$(this).closest("div[data-hex-multy]"),e=$(this).closest("[data-hex-multy-item]"),r=parseInt(e.attr("data-hex-multy-item")),i=t.find("[data-hex-multy-item]");u(e),e.remove(),i.each(function(t,e){t>r&&n($(this),--t)}),a(t)})};return p(),r}function n(t){if(void 0!==t)return void 0===a[t]&&(a[t]=new e($("#"+t))),a[t];var n=$("form.hex-form");return n.each(function(){var t=$(this).attr("id");if(void 0===t)throw new Error("Form dont have id attr");a[t]=new e($(this))}),a}var a={};return n}();