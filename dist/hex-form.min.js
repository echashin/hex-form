"use strict";this.HexWidget=function(){function e(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!0:!1}function t(e){function t(e){void 0!==e.input&&(a=e.input,n=a.closest(".form-group").find("button.password-show"),n.bind("click",function(e){return e.preventDefault(),"password"===r?(a.attr("type","text"),n.addClass("active"),r="text"):(a.attr("type","password"),n.removeClass("active"),r="password"),a.focus(),!1}))}var n,a,r="password";t(e)}function n(e){function t(e){return s=e.length>8?1:0,u=e.match(v)?1:0,d=e.match(f)?1:0,l=e.match(p)?1:0,c=e.match(h)?1:0,s+u+d+l+c}function n(e){void 0!==e.events&&i.setEvents(e.events),void 0!==e.input&&(a=e.input,r=a.closest(".form-group").find(".password-strength div"),a.bind("keyup change",function(){var e=a.val();r.attr("class","s-"+t(e))}))}var a,r,i=this,o=["change"],s=0,u=0,d=0,l=0,c=0,v=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(e){o=e},i.getEvents=function(){return o},n(e)}function a(e){function t(e){if(void 0!==e.input){n=e.input;var t=moment.localeData(),a={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:t.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:t.firstDayOfWeek()}};$.extend(a,e);var r=a.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");a.singleDatePicker===!1&&(r+=a.locale.separator+r),n.inputmask(r),n.daterangepicker(a,function(e,t){var r=e.format(a.locale.format);a.singleDatePicker===!1&&(r+=a.locale.separator+t.format(a.locale.format)),n.val(r),n.trigger("blur")})}}var n;t(e)}function r(t){function n(t){if(void 0!==t.control&&(r=t.control),void 0!==t.input){a=t.input;var n=t.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:n};if(void 0!==t.url){i="ajax";var s=a.find("option[selected]");if(t.ajax={url:t.url,method:"POST",dataType:"json",delay:250,data:function(e){return{search:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.rows,pagination:{more:t.page*e.limit<e.total}}},cache:!1},delete t.url,void 0!==t.parent){var u=t.parent.selector,d=t.parent.param||"parent_id";e($(u).val())&&(r.disable(),a.val("").trigger("change")),$(u).on("change",function(){e($(this).val())?(r.disable(),a.val("").trigger("change")):r.enable()}),delete t.parent;var l=function(){return $(u).val()};t.ajax.data=function(e){var t={search:e.term,page:e.page};return t[d]=l,t}}}$.extend(o,t),a.select2(o),"ajax"===i&&(s.each(function(){a.append($(this))}),a.trigger("change"))}}var a,r,i="local";n(t)}function i(e){function t(e){function t(e){r=e.target.files[0],a.setValue(r)}n=e.input,a=e.control,n.bind("change",t)}var n,a,r;t(e)}function o(e){function t(e){n=e.input,n.inputmask(e.mask)}var n;t(e)}function s(e){function t(e){void 0!==e.input&&(n=e.input,n.inputmask("+7(999)999-99-99"))}var n;t(e)}function u(e){function u(e){switch(e.type){case"password-strength":return new n(e);case"password-show":return new t(e);case"date":return new a(e);case"phone":return new s(e);case"select2":return new r(e);case"mask":return new o(e);case"filesimple":return new i(e);default:throw new Error("Unfinded widget: "+e.type)}}return u(e)}return u}(),this.HexValidator=function(){function e(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,a=["blur","change"];n.weight=0;var r="required";n.getClassName=function(){return r},n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!1:!0},t(e)}function t(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.input&&(r=e.input)}var n=this,a=["change","keyup","blur"];n.weight=3;var r,i="date";n.getClassName=function(){return i},n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){if(""===e||void 0===e||e===!1)return!0;var t=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:t})},t(e)}function n(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,a="email";n.getClassName=function(){return a};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){return""===e||void 0===e||e===!1?!0:i.test(e)},t(e)}function a(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.url&&(r=e.url)}var n=this,a="unique";n.getClassName=function(){return a};var r,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(e){s=e},n.getEvents=function(){return s},n.isValid=function(e){if(o!==!1&&o.abort(),i!==e){o=$.ajax({url:r,data:{value:e},method:"POST",async:!1});var t=o.responseText;return i="true"===t?e:!1,t}return!0},t(e)}function r(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.input&&(n=e.input)}var n,a=this,r="phone",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(){var e=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:e})},t(e)}function i(e){function t(e){void 0!==e.min&&(n=e.min),void 0!==e.max&&(a=e.max),void 0!==e.events&&r.setEvents(e.events)}var n,a,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(e){o=e},r.getEvents=function(){return o},r.isValid=function(e){var t=e.length;return void 0!==n&&n>t?(i="string-length-min",!1):void 0!==a&&t>a?(i="string-length-max",!1):!0},t(e)}function o(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.password&&(i=$(e.password))}var n=this,a="password-confirm";n.getClassName=function(){return a};var r=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){return i.val()===e},t(e)}function s(s){function u(s){switch(s.type){case"required":return new e(s);case"email":return new n(s);case"unique":return new a(s);case"password-confirm":return new o(s);case"string-length":return new i(s);case"date":return new t(s);case"phone":return new r(s);default:throw new Error("Unfinded validator: "+s.type)}}return u(s)}return s}(),this.hexForm=function(){function e(e){var t=this;t.type=void 0,t.valid=!0,t.name=void 0;var n,a,r,i,o=[],s=e.form;t.tabPanelId=void 0;var u,d=[],l={},c={};t.disabled=!1,t.readonly=!1,t.setValid=function(){r.removeClass("has-error"),a.find("span").removeClass("active")},t.enable=function(){for(var e in o)o[e].prop("disabled",!1);t.disabled=!1},t.disable=function(){for(var e in o)o[e].prop("disabled",!0);t.disabled=!0},t.addReadonly=function(){for(var e in o)o[e].prop("readonly",!0);t.readonly=!0},t.removeReadonly=function(){for(var e in o)o[e].prop("readonly",!1);t.readonly=!1};var v=function(e){return function(t,n){return"number"==typeof t[e]?t[e]-n[e]:t[e]<n[e]?-1:t[e]>n[e]?1:0}},f=function(){var e=0;if(a.find("span").removeClass("active"),!t.disabled)for(var i in d)if(d.hasOwnProperty(i)){var o=d[i],u=t.getValue(),l=o.isValid(u);if(l===!1||"false"===l){e++,a.find("span.error-"+o.getClassName()).addClass("active");break}}if(e>0?(t.valid=!1,r.addClass("has-error")):(r.removeClass("has-error"),t.valid=!0),void 0!==n){var c=!0;for(var v in s.controls)if(s.controls.hasOwnProperty(v)){var f=s.controls[v];if(f.tabPanelId===t.tabPanelId&&f.valid===!1){c=!1;break}}c===!0?n.removeClass("has-error"):n.addClass("has-error")}return t.valid};t.validate=function(e){return void 0===e?f():"blur"===e.type?f():(void 0!==i&&clearTimeout(i),void(i=setTimeout(f,500)))},t.trigger=function(e){for(var t=0;t<o.length;t++)o[t].trigger(e)};var p=function(e){for(var t={},n=e[0].attributes,a=n.length,r=0;a>r;r++)t[n[r].name.toLowerCase()]=n[r].value;return t},h=function(e,t,n){var a={input:n,type:e};void 0!==t&&""!==t&&$.extend(a,jQuery.parseJSON(t));var r=new HexValidator(a),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(c[i[o]]=!0);d.push(r)},m=function(e,n,a){var r={input:a,type:e,control:t};void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),l[e]=new HexWidget(r)};t.addInput=function(e){e.bind("hex-get-control",function(){return t}),o.push(e);var n=p(e);for(var a in n)if(n.hasOwnProperty(a)){if("required"===a)h("required",n[a],e);else{var r=a.match(/^data-hex-validator-(.*)$/i);null!==r&&void 0!==r[1]&&h(r[1],n[a],e)}var i=a.match(/^data-hex-widget-(.*)$/i);null!==i&&void 0!==i[1]&&m(i[1],n[a],e)}for(var s in c)c.hasOwnProperty(s)&&e.bind(s,t.validate);d.sort(v("weight")),e.prop("disabled")&&t.disable(),e.prop("readonly")&&t.addReadonly(),e.bind("disable",function(){t.disable()}),e.bind("enable",function(){t.enable()})},t.getValue=function(){switch(t.type){case"text":default:if(void 0!==l.date){var e=o[0].data("daterangepicker");if(void 0===e)return o[0].val();if(""===o[0].val())return!1;var n="";if(n+=e.startDate.format("YYYY-MM-DD"),e.singleDatePicker===!1){var a=e.endDate.format("YYYY-MM-DD");n+=" - "+a}return n}return void 0!==l.fileupload||void 0!==l.filesimple?u:o[0].val();case"radio":for(var r in o)if(o.hasOwnProperty(r)&&o[r].is(":checked")===!0)return o[r].val();return!1;case"checkbox":return o[0].is(":checked")===!0?t.trueValue:t.falseValue}},t.setValue=function(e){u=e};var g=function(e){if(void 0!==e.type&&(t.type=e.type,"checkbox"===e.type&&(t.trueValue=!0,t.falseValue=!1)),void 0!==e.form&&(s=e.form),t.name=e.name,void 0!==e.inputs)for(var i in e.inputs)e.inputs.hasOwnProperty(i)&&t.addInput(e.inputs[i]);r=o[0].closest("div.form-group"),a=r.find(".errors");var u=r.closest(".tab-pane");if(u.size()>0){var d=u.attr("id"),l=$('.nav a[href="#'+d+'"]');l.size()>0&&(n=l),t.tabPanelId=d}t.setValid()};g(e)}function t(t){function n(e){function t(e,t){e.attr("data-hex-multy-item",t),e.find('input[type!="submit"],select,textarea').each(function(){var e=$(this).attr("name");e=e.replace(/\[\d+\]/g,function(){return"["+t+"]"}),$(this).attr("name",e)})}function n(){if(r===!1){var t=e.find("[data-hex-multy-item]");t.size()<=1?e.find("[data-hex-multy-remove]").attr("disabled","disabled"):e.find("[data-hex-multy-remove]").removeAttr("disabled")}}var a=e.data("hex-multy"),r=!1;void 0!==a.allow_empty&&a.allow_empty===!0&&(r=!0);var i=e.find('[data-hex-multy-item="$"]'),o=i.clone(!1);i.remove(),o.find('input[type!="submit"],select,textarea').each(function(){$(this).val("")}),e.on("click","[data-hex-multy-add]",function(){var a=$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]"),r=a.size(),i=o.clone(!1);i.find("[data-hex-multy-hide]").remove(),i.find("[data-hex-multy-attr]").each(function(){var e=$(this),t=e.data("hex-multy-attr");if(void 0!==t.add&&$.each(t.add,function(t,n){for(var a in n)e.attr(a,n[a])}),void 0!==t.remove)for(var n in t.remove)e.removeAttr(t.remove[n])}),t(i,r),u(i),i.appendTo(e.find("[data-hex-multy-items]")),n()}),e.on("click","[data-hex-multy-remove]",function(){var a=$(this).closest("[data-hex-multy-item]"),r=parseInt(a.attr("data-hex-multy-item")),i=e.find("[data-hex-multy-item]");s(a),a.remove(),i.each(function(e,n){e>r&&t($(this),--e)}),n()}),n()}var a=this;a.controls={};var r=t,i={},o=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};a.on=function(e,t){void 0===i[e]&&(i[e]=[]),i[e].push(t)},a.off=function(e,t){void 0!==i[e]&&i[e].splice(i[e].indexOf(t),1)},a.fire=function(e,t){var n=new o(e);if(void 0!==i[e])for(var a in i[e]){var r=i[e][a];r(t,n)}return!n.stoped};var s=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,t){var n=$(t),r=n.attr("name");void 0!==a.controls[r]&&delete a.controls[r]})},u=function(t){$.each(t.find('input[type!="submit"],select,textarea'),function(t,n){var r=$(n),i=r.attr("name"),o=r.prop("tagName").toLowerCase();switch(o){case"select":case"textarea":a.controls[i]=new e({type:o,inputs:[r],form:a,name:i});break;case"input":var s=r.attr("type").toLowerCase();switch(s){default:a.controls[i]=new e({type:s,inputs:[r],form:a,name:i});break;case"checkbox":var u=new e({type:"checkbox",inputs:[r],form:a,name:i});void 0!==r.attr("value")&&(u.trueValue=r.attr("value")),void 0!==r.attr("data-hex-true-value")&&(u.trueValue=r.attr("data-hex-true-value")),void 0!==r.attr("data-hex-false-value")&&(u.falseValue=r.attr("data-hex-false-value")),a.controls[i]=u;break;case"radio":void 0===a.controls[i]?a.controls[i]=new e({type:"radio",inputs:[r],form:a,name:i}):a.controls[i].addInput(r)}}})},d=function(){var e={};for(var t in a.controls)if(a.controls.hasOwnProperty(t)&&a.controls[t].disabled===!1){var n=a.controls[t].name,r=a.controls[t].getValue();null===r||$.isArray(r)&&0===r.length?r="":e[n]=r}return e},l=function(e){var t=a.fire("beforeReset",{values:a.getValues()});t?window.setTimeout(function(){for(var e in a.controls)a.controls.hasOwnProperty(e)&&a.controls[e].trigger("change")},1):e.preventDefault(),a.fire("afterReset",{})},c=function(){r.find(".has-error").removeClass("has-error"),r.find(".alerts div").remove()},v=function(e){e.preventDefault(),e.stopPropagation();var t=!0;for(var n in a.controls)a.controls.hasOwnProperty(n)&&a.controls[n].validate(void 0)===!1&&(t=!1);if(t===!0){c();var i=d(),o=a.fire("beforeSubmit",{values:i});if(o){a.loaderShow();var s=r.attr("action"),u=r.find("button[type=submit]:focus");u.size()>0&&void 0!==u.attr("data-action")&&(s=u.attr("data-action"));var l="POST";void 0!==r.attr("method")&&(l=r.attr("method"));var v=new FormData;$.each(i,function(e,t){if($.isArray(t)||$.isPlainObject(t))for(var n in t)null!==t[n]&&t[n]!==!1&&void 0!==t[n]&&v.append(e,t[n]);else v.append(e,t)}),$.ajax({url:s,data:v,type:l,dataType:"json",processData:!1,contentType:!1,success:function(e){if(a.loaderHide(),e.success===!0&&(c(),void 0!==e.reload&&(e.reload===!0?window.location.href=window.location.href:window.location.href=e.reload)),void 0!==e.alerts)for(var t in e.alerts){var n=e.alerts[t];r.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}},error:function(e,t,n){a.loaderHide()}})}}return!1};a.loaderShow=function(){r.find(".loader").show()},a.loaderHide=function(){r.find(".loader").hide()},a.submit=function(){v()},a.getValues=function(){return d()};var f=function(){r.addClass("loader-container").append('<div class="loader"></div>'),r.bind("submit",v),r.bind("reset",l),0===r.find(".loader").size()&&r.append('<div class="loader"></div>'),u(r),r.find("div[data-hex-multy]").size()>0&&r.find("div[data-hex-multy]").each(function(){n($(this))})};return f(),a}function n(e){if(void 0!==e)return void 0===a[e]&&(a[e]=new t($("#"+e))),a[e];var n=$("form.hex-form");return n.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");a[e]=new t($(this))}),a}var a={};return n}();