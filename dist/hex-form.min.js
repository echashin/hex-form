var HexWidget=function(t,e){"use strict";function a(t){return null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?!0:!1}function n(t){function e(t){void 0!==t.input&&(n=t.input,a=n.closest(".form-group").find("button.password-show"),a.bind("click",function(t){return t.preventDefault(),"password"===r?(n.attr("type","text"),a.addClass("active"),r="text"):(n.attr("type","password"),a.removeClass("active"),r="password"),n.focus(),!1}))}var a,n,r="password";e(t)}function r(t){function e(t){return s=t.length>8?1:0,u=t.match(f)?1:0,l=t.match(v)?1:0,d=t.match(p)?1:0,c=t.match(m)?1:0,s+u+l+d+c}function a(t){void 0!==t.events&&i.setEvents(t.events),void 0!==t.input&&(n=t.input,r=n.closest(".form-group").find(".password-strength div"),n.bind("keyup change",function(){var t=n.val();r.attr("class","s-"+e(t))}))}var n,r,i=this,o=["change"],s=0,u=0,l=0,d=0,c=0,f=new RegExp("[A-ZА-Я]"),v=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),m=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(t){o=t},i.getEvents=function(){return o},a(t)}function i(t){function e(t){if(void 0!==t.input){a=t.input;var e=moment.localeData(),n={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:e.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:e.firstDayOfWeek()}};$.extend(n,t),void 0!==n.timePicker&&n.timePicker===!0&&void 0!==n.timePicker24Hour&&n.timePicker24Hour===!0&&(n.locale.format+=" HH:mm");var r=n.locale.format.replace(/[H]/g,"9").replace(/[m]/g,"9").replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");n.singleDatePicker===!1&&(r+=n.locale.separator+r),a.inputmask(r),a.daterangepicker(n,function(t,e){var r=t.format(n.locale.format);n.singleDatePicker===!1&&(r+=n.locale.separator+e.format(n.locale.format)),a.val(r),a.trigger("blur")})}}var a;e(t)}function o(t){function e(t){if(void 0!==t.control&&(r=t.control),void 0!==t.input){n=t.input;var e=t.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:e};if(void 0!==t.url){i="ajax";var s=n.find("option[selected]");if(t.ajax={url:t.url,method:"POST",dataType:"json",delay:250,data:function(t){return{search:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.rows,pagination:{more:e.page*t.limit<t.total}}},cache:!1},delete t.url,void 0!==t.parent){var u=t.parent.selector,l=t.parent.param||"parent_id";a($(u).val())&&(r.disable(),n.val("").trigger("change")),$(u).on("change",function(){a($(this).val())?(r.disable(),n.val("").trigger("change")):r.enable()}),delete t.parent;var d=function(){return $(u).val()};t.ajax.data=function(t){var e={search:t.term,page:t.page};return e[l]=d,e}}}$.extend(o,t),n.select2(o),"ajax"===i&&(s.each(function(){n.append($(this))}),n.trigger("change"))}}var n,r,i="local";e(t)}function s(t){function e(t){function e(t){r=t.target.files[0],n.setValue(r)}a=t.input,n=t.control,a.bind("change",e)}var a,n,r;e(t)}function u(t){function e(t){a=t.input,a.inputmask(t.mask)}var a;e(t)}function l(t){function e(t){void 0!==t.input&&(a=t.input,a.inputmask("+7(999)999-99-99"))}var a;e(t)}function d(t){function e(t){switch(t.type){case"password-strength":return new r(t);case"password-show":return new n(t);case"date":return new i(t);case"phone":return new l(t);case"select2":return new o(t);case"mask":return new u(t);case"filesimple":return new s(t);default:throw new Error("Unfinded widget: "+t.type)}}return e(t)}return d}(window,document),HexValidator=function(){"use strict";function t(t){function e(t){void 0!==t.events&&a.setEvents(t.events)}var a=this,n=["blur","change"];a.weight=0;var r="required";a.getClassName=function(){return r},a.setEvents=function(t){n=t},a.getEvents=function(){return n},a.isValid=function(t){return null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?!1:!0},e(t)}function e(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.input&&(r=t.input)}var a=this,n=["change","keyup","blur"];a.weight=3;var r,i="date";a.getClassName=function(){return i},a.setEvents=function(t){n=t},a.getEvents=function(){return n},a.isValid=function(t){if(""===t||void 0===t||t===!1)return!0;var e=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:e})},e(t)}function a(t){function e(t){void 0!==t.events&&a.setEvents(t.events)}var a=this,n="email";a.getClassName=function(){return n};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;a.weight=1,a.setEvents=function(t){r=t},a.getEvents=function(){return r},a.isValid=function(t){return""===t||void 0===t||t===!1?!0:i.test(t)},e(t)}function n(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.url&&(r=t.url)}var a=this,n="unique";a.getClassName=function(){return n};var r,i=!1,o=!1,s=["change","keyup","blur"];a.weight=5,a.setEvents=function(t){s=t},a.getEvents=function(){return s},a.isValid=function(t){if(o!==!1&&o.abort(),i!==t){o=$.ajax({url:r,data:{value:t},method:"POST",async:!1});var e=o.responseText;return i="true"===e?t:!1,e}return!0},e(t)}function r(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.input&&(a=t.input)}var a,n=this,r="phone",i=["blur"];n.getClassName=function(){return r},n.weight=4,n.setEvents=function(t){i=t},n.getEvents=function(){return i},n.isValid=function(t){if(""===t||void 0===t||t===!1||null===t)return!0;var e=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:e})},e(t)}function i(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.input&&(a=t.input)}var a,n=this,r="mask",i=["blur"];n.getClassName=function(){return r},n.weight=4,n.setEvents=function(t){i=t},n.getEvents=function(){return i},n.isValid=function(t){if(""===t||void 0===t||t===!1||null===t)return!0;var e=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:e})},e(t)}function o(t){function e(t){void 0!==t.min&&(a=t.min),void 0!==t.max&&(n=t.max),void 0!==t.events&&r.setEvents(t.events)}var a,n,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(t){o=t},r.getEvents=function(){return o},r.isValid=function(t){var e=t.length;return void 0!==a&&a>e?(i="string-length-min",!1):void 0!==n&&e>n?(i="string-length-max",!1):!0},e(t)}function s(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.password&&(i=$(t.password))}var a=this,n="password-confirm";a.getClassName=function(){return n};var r=["change","keyup","blur"];a.weight=4;var i;a.setEvents=function(t){r=t},a.getEvents=function(){return r},a.isValid=function(t){return i.val()===t},e(t)}function u(u){function l(u){switch(u.type){case"required":return new t(u);case"email":return new a(u);case"unique":return new n(u);case"password-confirm":return new s(u);case"string-length":return new o(u);case"date":return new e(u);case"phone":return new r(u);case"mask":return new i(u);default:throw new Error("Unfinded validator: "+u.type)}}return l(u)}return u}(),hexForm=function(t,e){"use strict";function a(t){function e(t){return function(e,a){return"number"==typeof e[t]?e[t]-a[t]:e[t]<a[t]?-1:e[t]>a[t]?1:0}}var a=this;a.type=void 0,a.valid=!0,a.name=void 0;var n,r,i=[],o=t.form;a.formGroup=void 0,a.panels=[],a.tabs=[];var s,u=[],l={},d={};a.disabled=!1,a.readonly=!1,a.setValid=function(){a.formGroup.removeClass("has-error"),n.find("span").removeClass("active")},a.enable=function(){for(var t in i)i[t].prop("disabled",!1);a.disabled=!1},a.disable=function(){for(var t in i)i[t].prop("disabled",!0);a.disabled=!0},a.addReadonly=function(){for(var t in i)i[t].prop("readonly",!0);a.readonly=!0},a.removeReadonly=function(){for(var t in i)i[t].prop("readonly",!1);a.readonly=!1};var c=function(){var t=0;if(n.find("span").removeClass("active"),!a.disabled)for(var e in u)if(u.hasOwnProperty(e)){var r=u[e],i=a.getValue(),s=r.isValid(i);if(s===!1||"false"===s){t++,n.find("span.error-"+r.getClassName()).addClass("active");break}}if(t>0?(a.valid=!1,a.formGroup.addClass("has-error")):(a.formGroup.removeClass("has-error"),a.valid=!0),a.panels.length>0){var l=!0;if(a.valid===!0){for(var d in o.controls)if(o.controls.hasOwnProperty(d)){var c=o.controls[d];if(c.valid===!1)for(var f in c.panels){var v=c.panels[f];for(var p in a.panels)if(v===a.panels[p]){l=!1;break}}}}else l=!1;l===!0?$.each(a.tabs,function(t,e){e.removeClass("has-error")}):$.each(a.tabs,function(t,e){e.addClass("has-error")})}return a.valid};a.validate=function(t){return void 0===t?c():"blur"===t.type?c():(void 0!==r&&clearTimeout(r),void(r=setTimeout(c,500)))},a.trigger=function(t){for(var e=0;e<i.length;e++)i[e].trigger(t)};var f=function(t){for(var e={},a=t[0].attributes,n=a.length,r=0;n>r;r++)e[a[r].name.toLowerCase()]=a[r].value;return e},v=function(t,e,a){var n={input:a,type:t};void 0!==e&&""!==e&&$.extend(n,jQuery.parseJSON(e));var r=new HexValidator(n),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(d[i[o]]=!0);u.push(r)},p=function(t,e,n){var r={input:n,type:t,control:a};void 0!==e&&""!==e&&$.extend(r,jQuery.parseJSON(e)),l[t]=new HexWidget(r)};a.addInput=function(t){i.push(t);var n=f(t);for(var r in n)if(n.hasOwnProperty(r)){if("required"===r)v("required",n[r],t);else{var o=r.match(/^data-hex-validator-(.*)$/i);null!==o&&void 0!==o[1]&&v(o[1],n[r],t)}var s=r.match(/^data-hex-widget-(.*)$/i);null!==s&&void 0!==s[1]&&p(s[1],n[r],t)}for(var l in d)d.hasOwnProperty(l)&&t.bind(l,a.validate);u.sort(e("weight")),t.prop("disabled")&&a.disable(),t.prop("readonly")&&a.addReadonly(),t.bind("disable",function(){a.disable()}),t.bind("enable",function(){a.enable()})},a.getValue=function(){switch(a.type){case"text":default:if(void 0!==l.date){var t=i[0].data("daterangepicker");if(void 0===t)return i[0].val();if(""===i[0].val())return!1;var e="",n="YYYY-MM-DD";if(t.timePicker===!0&&(n+=" HH:mm"),e+=t.startDate.format(n),t.singleDatePicker===!1){var r=t.endDate.format(n);e+=" - "+r}return e}return void 0!==l.fileupload||void 0!==l.filesimple?s:i[0].val();case"radio":for(var o in i)if(i.hasOwnProperty(o)&&i[o].is(":checked")===!0)return i[o].val();return!1;case"checkbox":return i[0].is(":checked")===!0?a.trueValue:a.falseValue}},a.setValue=function(t){s=t};var m=function(t){if(void 0!==t.type&&(a.type=t.type,"checkbox"===t.type&&(a.trueValue=!0,a.falseValue=!1)),void 0!==t.form&&(o=t.form),a.name=t.name,void 0!==t.inputs)for(var e in t.inputs)t.inputs.hasOwnProperty(e)&&a.addInput(t.inputs[e]);a.formGroup=i[0].closest("div.form-group"),n=a.formGroup.find(".errors"),a.formGroup.parents('[role="tabpanel"]').size()>0&&a.formGroup.parents('[role="tabpanel"]').each(function(){var t=$(this),e=t.attr("id");a.panels.push(e);var n=$('.nav a[href="#'+e+'"]');n.size()>0&&a.tabs.push(n)}),a.setValid()};m(t)}function n(n){function r(t){function e(t,e){if(void 0!==t.attr("data-hex-multy-item")&&t.attr("data-hex-multy-item",e),void 0!==t.attr("data-hex-multy-tab")){t.attr("data-hex-multy-tab",e);var a=t.find("a");if(a.attr("href",a.attr("href").replace(/\d+/g,e)),a.attr("aria-controls",a.attr("aria-controls").replace(/\d+/g,e)),a.find("[data-hex-multy-tab-label]").size()>0){var n=a.find("[data-hex-multy-tab-label]").html();n=n.replace(/\d+/g,e+1),a.find("[data-hex-multy-tab-label]").html(n)}}if(void 0!==t.attr("id")){var r=t.attr("id");t.attr("id",r.replace(/\d+/,e))}t.find('input[type!="submit"],select,textarea').each(function(){var t=$(this).attr("name");t=t.replace(/\[\d+\]/g,function(){return"["+e+"]"}),$(this).attr("name",t)})}function a(){if(o===!1){var e=t.find("[data-hex-multy-item]");e.size()<=1?t.find("[data-hex-multy-remove]").attr("disabled","disabled"):t.find("[data-hex-multy-remove]").removeAttr("disabled")}}var n,r,i=t.data("hex-multy"),o=!1;void 0!==i.allow_empty&&i.allow_empty===!0&&(o=!0),t.find("[data-hex-multy-tabs]").size()>0&&(n=t.find("[data-hex-multy-tabs]"),r=n.find('[data-hex-multy-tab="$"]').clone(!1),n.find('[data-hex-multy-tab="$"]').remove());var s=t.find('[data-hex-multy-item="$"]'),u=s.clone(!1);s.remove(),u.find('input[type!="submit"],select,textarea').each(function(){$(this).val("")}),t.on("click","[data-hex-multy-add]",function(){var a=$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]"),i=a.size(),o=u.clone(!1);if(o.find("[data-hex-multy-hide]").remove(),o.find("[data-hex-multy-attr]").each(function(){var t=$(this),e=t.data("hex-multy-attr");if(void 0!==e.add&&$.each(e.add,function(e,a){for(var n in a)t.attr(n,a[n])}),void 0!==e.remove)for(var a in e.remove)t.removeAttr(e.remove[a])}),e(o,i),o.appendTo(t.find("[data-hex-multy-items]")),void 0!==n){var s=r.clone(!1);e(s,i),n.append(s)}c(o),void 0!==n&&$('a[href="#'+o.attr("id")+'"]').trigger("click")}),t.on("click","[data-hex-multy-remove]",function(){var r=$(this).closest("[data-hex-multy-item]"),i=parseInt(r.attr("data-hex-multy-item")),o=t.find("[data-hex-multy-item]");d(r),r.remove(),o.each(function(){$(this).attr("data-hex-multy-item")>i&&e($(this),$(this).attr("data-hex-multy-item")-1)}),void 0!==n&&(n.find('[data-hex-multy-tab="'+i+'"]').remove(),n.find("[data-hex-multy-tab]").each(function(){$(this).attr("data-hex-multy-tab")>i&&e($(this),$(this).attr("data-hex-multy-tab")-1)}),n.find('a[role="tab"]:first').trigger("click")),a()}),a()}var i=this;i.controls={};var o=n,s=o.attr("id"),u={},l=function(t){this.type=t,this.stoped=!1,this.stop=function(){this.stoped=!0}};i.on=function(t,e){void 0===u[t]&&(u[t]=[]),u[t].push(e)},i.off=function(t,e){void 0!==u[t]&&u[t].splice(u[t].indexOf(e),1)},i.fire=function(t,e){var a=new l(t);if(void 0!==u[t])for(var n in u[t]){var r=u[t][n];r(e,a)}return!a.stoped};var d=function(t){$.each(t.find('input[type!="submit"],select,textarea'),function(t,e){var a=$(e),n=a.attr("name");void 0!==i.controls[n]&&delete i.controls[n]})},c=function(t){$.each(t.find('input[type!="submit"],select,textarea'),function(t,e){var n=$(e),r=n.attr("name"),o=n.prop("tagName").toLowerCase();switch(o){case"select":case"textarea":i.controls[r]=new a({type:o,inputs:[n],form:i,name:r});break;case"input":var s=n.attr("type").toLowerCase();switch(s){default:i.controls[r]=new a({type:s,inputs:[n],form:i,name:r});break;case"checkbox":var u=new a({type:"checkbox",inputs:[n],form:i,name:r});void 0!==n.attr("value")&&(u.trueValue=n.attr("value")),void 0!==n.attr("data-hex-true-value")&&(u.trueValue=n.attr("data-hex-true-value")),void 0!==n.attr("data-hex-false-value")&&(u.falseValue=n.attr("data-hex-false-value")),i.controls[r]=u;break;case"radio":void 0===i.controls[r]?i.controls[r]=new a({type:"radio",inputs:[n],form:i,name:r}):i.controls[r].addInput(n)}}})},f=function(){var t={};for(var e in i.controls)if(i.controls.hasOwnProperty(e)&&i.controls[e].disabled===!1){var a=i.controls[e].name,n=i.controls[e].getValue();null===n||$.isArray(n)&&0===n.length?n="":t[a]=n}return t},v=function(e){var a=i.fire("beforeReset",{values:i.getValues()});a?t.setTimeout(function(){for(var t in i.controls)i.controls.hasOwnProperty(t)&&i.controls[t].trigger("change")},1):e.preventDefault(),i.fire("afterReset",{})},p=function(){o.find(".has-error").removeClass("has-error"),o.find(".alerts div").remove()},m=function(e){e.preventDefault(),e.stopPropagation();var a=!0;for(var n in i.controls)i.controls.hasOwnProperty(n)&&i.controls[n].validate(void 0)===!1&&(a=!1);if(a===!0){p();var r=f(),s=i.fire("beforeSubmit",{values:r});if(s){i.loaderShow();var u=o.attr("action"),l=o.find("button[type=submit]:focus");l.size()>0&&void 0!==l.attr("data-action")&&(u=l.attr("data-action"));var d="POST";void 0!==o.attr("method")&&(d=o.attr("method"));var c=new FormData;$.each(r,function(t,e){if($.isArray(e)||$.isPlainObject(e))for(var a in e)null!==e[a]&&e[a]!==!1&&void 0!==e[a]&&c.append(t,e[a]);else c.append(t,e)}),$.ajax({url:u,data:c,type:d,dataType:"json",processData:!1,contentType:!1,success:function(e){if(e.success===!0?(p(),void 0!==e.reload?e.reload===!0?t.location.href=t.location.href:t.location.href=e.reload:i.loaderHide()):i.loaderHide(),void 0!==e.alerts){for(var a in e.alerts){var n=e.alerts[a];o.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}i.loaderHide()}},error:function(t,e,a){i.loaderHide()}})}}return!1};i.loaderShow=function(){o.find(".loader").show()},i.loaderHide=function(){o.find(".loader").hide()},i.submit=function(){m()},i.getValues=function(){return f()};var h=function(){o.addClass("loader-container").append('<div class="loader"></div>'),$(e).on("submit","#"+s,m),$(e).on("reset","#"+s,v),0===o.find(".loader").size()&&o.append('<div class="loader"></div>'),c(o),o.find("div[data-hex-multy]").size()>0&&o.find("div[data-hex-multy]").each(function(){r($(this))})};return h(),i}function r(t){if(void 0!==t)return void 0===i[t]&&(i[t]=new n($("#"+t))),i[t];var e=$("form.hex-form");return e.each(function(){var t=$(this).attr("id");if(void 0===t)throw new Error("Form dont have id attr");i[t]=new n($(this))}),i}var i={};return r}(window,document);