"use strict";this.HexWidget=function(){function t(t){function e(t){void 0!==t.input&&(a=t.input,n=a.closest(".form-group").find("button.password-show"),n.bind("click",function(t){return t.preventDefault(),"password"===r?(a.attr("type","text"),n.addClass("active"),r="text"):(a.attr("type","password"),n.removeClass("active"),r="password"),a.focus(),!1}))}var n,a,r="password";e(t)}function e(t){function e(t){return s=t.length>8?1:0,u=t.match(f)?1:0,c=t.match(d)?1:0,v=t.match(p)?1:0,l=t.match(m)?1:0,s+u+c+v+l}function n(t){void 0!==t.events&&i.setEvents(t.events),void 0!==t.input&&(a=t.input,r=a.closest(".form-group").find(".password-strength div"),a.bind("keyup change",function(){var t=a.val();r.attr("class","s-"+e(t))}))}var a,r,i=this,o=["change"],s=0,u=0,c=0,v=0,l=0,f=new RegExp("[A-ZА-Я]"),d=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),m=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(t){o=t},i.getEvents=function(){return o},n(t)}function n(t){function e(t){if(void 0!==t.input){n=t.input;var e=moment.localeData(),a={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:e.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:e.firstDayOfWeek()}};$.extend(a,t);var r=a.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");a.singleDatePicker===!1&&(r+=a.locale.separator+r),n.inputmask(r),n.daterangepicker(a,function(t,e){var r=t.format(a.locale.format);a.singleDatePicker===!1&&(r+=a.locale.separator+e.format(a.locale.format)),n.val(r),n.trigger("blur")})}}var n;e(t)}function a(t){function e(t){void 0!==t.input&&(n=t.input,n.inputmask("+7(999)999-99-99"))}var n;e(t)}function r(r){function i(r){switch(r.type){case"password-strength":return new e(r);case"password-show":return new t(r);case"date":return new n(r);case"phone":return new a(r);default:throw new Error("Unfinded widget: "+r.type)}}return i(r)}return r}(),this.HexValidator=function(){function t(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a=["blur"];n.weight=0;var r="required";n.getClassName=function(){return r},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(t){return t===!1||void 0===t||""===t?!1:!0},e(t)}function e(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.input&&(r=t.input)}var n=this,a=["change","keyup","blur"];n.weight=3;var r,i="date";n.getClassName=function(){return i},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(){var t=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:t})},e(t)}function n(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a="email";n.getClassName=function(){return a};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return i.test(t)},e(t)}function a(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.url&&(r=t.url)}var n=this,a="unique";n.getClassName=function(){return a};var r,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(t){s=t},n.getEvents=function(){return s},n.isValid=function(t){if(o!==!1&&o.abort(),i!==t){o=$.ajax({url:r,data:{value:t},method:"POST",async:!1});var e=o.responseText;return i="true"===e?t:!1,e}return!0},e(t)}function r(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.input&&(n=t.input)}var n,a=this,r="phone",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(t){i=t},a.getEvents=function(){return i},a.isValid=function(){var t=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:t})},e(t)}function i(t){function e(t){void 0!==t.min&&(n=t.min),void 0!==t.max&&(a=t.max),void 0!==t.events&&r.setEvents(t.events)}var n,a,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(t){o=t},r.getEvents=function(){return o},r.isValid=function(t){var e=t.length;return void 0!==n&&n>e?(i="string-length-min",!1):void 0!==a&&e>a?(i="string-length-max",!1):!0},e(t)}function o(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.password&&(i=$(t.password))}var n=this,a="password-confirm";n.getClassName=function(){return a};var r=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return i.val()===t},e(t)}function s(s){function u(s){switch(s.type){case"required":return new t(s);case"email":return new n(s);case"unique":return new a(s);case"password-confirm":return new o(s);case"string-length":return new i(s);case"date":return new e(s);case"phone":return new r(s);default:throw new Error("Unfinded validator: "+s.type)}}return u(s)}return s}(),this.hexForm=function(){function t(t){var e=this;e.type=void 0,e.valid=!0,e.name=void 0;var n,a,r,i,o=[],s=t.form;e.tabPanel=void 0;var u=[],c={},v={},l=function(t){return function(e,n){return"number"==typeof e[t]?e[t]-n[t]:e[t]<n[t]?-1:e[t]>n[t]?1:0}},f=function(){var t=0;a.find("span").removeClass("active");for(var i in u)if(u.hasOwnProperty(i)){var o=u[i],c=e.getValue(),v=o.isValid(c);if(v===!1||"false"===v){t++,a.find("span.error-"+o.getClassName()).addClass("active");break}}if(t>0?(e.valid=!1,r.addClass("has-error")):(r.removeClass("has-error"),e.valid=!0),void 0!==n){var l=!0;for(var f in s.controls)if(s.controls.hasOwnProperty(f)){var d=s.controls[f];if(d.tabPanel===e.tabPanel&&d.valid===!1){l=!1;break}}l===!0?n.removeClass("has-error"):n.addClass("has-error")}return e.valid};e.validate=function(t){return void 0===t?f():"blur"===t.type?f():(void 0!==i&&clearTimeout(i),void(i=setTimeout(f,500)))};var d=function(t){for(var e={},n=t[0].attributes,a=n.length,r=0;a>r;r++)e[n[r].name.toLowerCase()]=n[r].value;return e},p=function(t,e,n){var a={input:n,type:t};void 0!==e&&""!==e&&$.extend(a,jQuery.parseJSON(e));var r=new HexValidator(a),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(v[i[o]]=!0);u.push(r)},m=function(t,e,n){var a={input:n,type:t};void 0!==e&&""!==e&&$.extend(a,jQuery.parseJSON(e)),c[t]=new HexWidget(a)};e.addInput=function(t){o.push(t);var n=d(t);for(var a in n)if(n.hasOwnProperty(a)){if("required"===a)p("required",n[a],t);else{var r=a.match(/^data-hex-validator-(.*)$/i);null!==r&&void 0!==r[1]&&p(r[1],n[a],t)}var i=a.match(/^data-hex-widget-(.*)$/i);null!==i&&void 0!==i[1]&&m(i[1],n[a],t)}for(var s in v)v.hasOwnProperty(s)&&t.bind(s,e.validate);u.sort(l("weight"))},e.getValue=function(){switch(e.type){case"text":default:if(void 0!==c.date){var t=o[0].data("daterangepicker");if(void 0===t)return o[0].val();if(""===o[0].val())return!1;var n="";if(n+=t.startDate.format("YYYY-MM-DD"),t.singleDatePicker===!1){var a=t.endDate.format("YYYY-MM-DD");n+=" - "+a}return n}return o[0].val();case"radio":for(var r in o)if(o.hasOwnProperty(r)&&o[r].is(":checked")===!0)return o[r].val();return!1;case"checkbox":return o[0].is(":checked")===!0?e.trueValue:e.falseValue}};var h=function(t){if(void 0!==t.type&&(e.type=t.type,"checkbox"===t.type&&(e.trueValue=!0,e.falseValue=!1)),void 0!==t.form&&(s=t.form),e.name=t.name,void 0!==t.inputs)for(var i in t.inputs)t.inputs.hasOwnProperty(i)&&e.addInput(t.inputs[i]);if(r=o[0].closest("div.form-group"),a=r.find(".errors"),e.tabPanel=o[0].closest(".tab-pane"),e.tabPanel.size()>0){var u=e.tabPanel.attr("id"),c=$('.nav a[href="#'+u+'"]');c.size()>0&&(n=c)}};h(t)}function e(e){var n=this;n.controls=[];var a=function(){$.each(e.find('input[type!="submit"],select,textarea'),function(e,a){var r=$(a),i=r.prop("tagName").toLowerCase();switch(i){case"textarea":n.controls.push(new t({type:"textarea",inputs:[r],form:n,name:r.attr("name")}));break;case"select":n.controls.push(new t({type:"select",inputs:[r],form:n,name:r.attr("name")}));break;case"input":var o=r.attr("type").toLowerCase();switch(o){default:n.controls.push(new t({type:o,inputs:[r],form:n,name:r.attr("name")}));break;case"checkbox":var s=new t({type:"checkbox",inputs:[r],form:n,name:r.attr("name")});void 0!==r.attr("data-hex-true-value")?s.trueValue=r.attr("data-hex-true-value"):s.trueValue=r.attr("value"),void 0!==r.attr("data-hex-false-value")&&(s.falseValue=r.attr("data-hex-false-value")),n.controls.push(s);break;case"radio":void 0===n.controls[r.attr("name")]?n.controls[r.attr("name")]=new t({type:"radio",inputs:[r],form:n,name:r.attr("name")}):n.controls[r.attr("name")].addInput(r)}}})},r=function(){var t={};for(var e in n.controls)if(n.controls.hasOwnProperty(e)){var a=n.controls[e].name;t[a]=n.controls[e].getValue()}return t},i=function(t){t.preventDefault();var a=!0;for(var i in n.controls)n.controls.hasOwnProperty(i)&&n.controls[i].validate(void 0)===!1&&(a=!1);if(a===!0){var o=r(),s=e.attr("action");e.find(".has-error").removeClass("has-error"),e.find(".alert").remove();var u=e.find("button[type=submit]:focus");u.size()>0&&void 0!==u.attr("data-action")&&(s=u.attr("data-action")),$.ajax({url:s,data:o,type:"POST",dataType:"json",complete:function(){},error:function(t,e,n){console.log(e,n)}})}return!1};n.submit=function(){i()},n.getValues=function(){return r()};var o=function(){e.addClass("loader-container").append('<div class="loader"></div>'),e.bind("submit",i),a()};return o(),n}function n(t){var n=$("form.hex-form");return n.each(function(){var t=$(this).attr("id");if(void 0===t)throw new Error("Form dont have id attr");a[t]=new e($(this))}),void 0!==t?a[t]:a}var a={};return n}();