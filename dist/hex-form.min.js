"use strict";this.HexWidget=function(){function t(t){function e(t){void 0!==t.input&&(a=t.input,n=a.closest(".form-group").find("button.password-show"),n.bind("click",function(t){return t.preventDefault(),"password"===r?(a.attr("type","text"),n.addClass("active"),r="text"):(a.attr("type","password"),n.removeClass("active"),r="password"),a.focus(),!1}))}var n,a,r="password";e(t)}function e(t){function e(t){return s=t.length>8?1:0,u=t.match(v)?1:0,c=t.match(f)?1:0,d=t.match(p)?1:0,l=t.match(h)?1:0,s+u+c+d+l}function n(t){void 0!==t.events&&i.setEvents(t.events),void 0!==t.input&&(a=t.input,r=a.closest(".form-group").find(".password-strength div"),a.bind("keyup change",function(){var t=a.val();r.attr("class","s-"+e(t))}))}var a,r,i=this,o=["change"],s=0,u=0,c=0,d=0,l=0,v=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(t){o=t},i.getEvents=function(){return o},n(t)}function n(t){function e(t){if(void 0!==t.input){n=t.input;var e=moment.localeData(),a={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:e.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:e.firstDayOfWeek()}};$.extend(a,t);var r=a.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");a.singleDatePicker===!1&&(r+=a.locale.separator+r),n.inputmask(r),n.daterangepicker(a,function(t,e){var r=t.format(a.locale.format);a.singleDatePicker===!1&&(r+=a.locale.separator+e.format(a.locale.format)),n.val(r),n.trigger("blur")})}}var n;e(t)}function a(t){function e(t){if(void 0!==t.input){n=t.input;var e={theme:"bootstrap"};$.extend(e,t),n.select2(e)}}var n;e(t)}function r(t){function e(t){function e(t){r=t.target.files[0],a.setValue(r)}n=t.input,a=t.control,n.bind("change",e)}var n,a,r;e(t)}function i(t){function e(t){void 0!==t.input&&(n=t.input,n.inputmask("+7(999)999-99-99"))}var n;e(t)}function o(o){function s(o){switch(o.type){case"password-strength":return new e(o);case"password-show":return new t(o);case"date":return new n(o);case"phone":return new i(o);case"select2":return new a(o);case"filesimple":return new r(o);default:throw new Error("Unfinded widget: "+o.type)}}return s(o)}return o}(),this.HexValidator=function(){function t(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a=["blur"];n.weight=0;var r="required";n.getClassName=function(){return r},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(t){return t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?(console.log(t),!1):!0},e(t)}function e(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.input&&(r=t.input)}var n=this,a=["change","keyup","blur"];n.weight=3;var r,i="date";n.getClassName=function(){return i},n.setEvents=function(t){a=t},n.getEvents=function(){return a},n.isValid=function(t){if(""===t||void 0===t||t===!1)return!0;var e=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:e})},e(t)}function n(t){function e(t){void 0!==t.events&&n.setEvents(t.events)}var n=this,a="email";n.getClassName=function(){return a};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return""===t||void 0===t||t===!1?!0:i.test(t)},e(t)}function a(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.url&&(r=t.url)}var n=this,a="unique";n.getClassName=function(){return a};var r,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(t){s=t},n.getEvents=function(){return s},n.isValid=function(t){if(o!==!1&&o.abort(),i!==t){o=$.ajax({url:r,data:{value:t},method:"POST",async:!1});var e=o.responseText;return i="true"===e?t:!1,e}return!0},e(t)}function r(t){function e(t){void 0!==t.events&&a.setEvents(t.events),void 0!==t.input&&(n=t.input)}var n,a=this,r="phone",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(t){i=t},a.getEvents=function(){return i},a.isValid=function(){var t=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:t})},e(t)}function i(t){function e(t){void 0!==t.min&&(n=t.min),void 0!==t.max&&(a=t.max),void 0!==t.events&&r.setEvents(t.events)}var n,a,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(t){o=t},r.getEvents=function(){return o},r.isValid=function(t){var e=t.length;return void 0!==n&&n>e?(i="string-length-min",!1):void 0!==a&&e>a?(i="string-length-max",!1):!0},e(t)}function o(t){function e(t){void 0!==t.events&&n.setEvents(t.events),void 0!==t.password&&(i=$(t.password))}var n=this,a="password-confirm";n.getClassName=function(){return a};var r=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(t){r=t},n.getEvents=function(){return r},n.isValid=function(t){return i.val()===t},e(t)}function s(s){function u(s){switch(s.type){case"required":return new t(s);case"email":return new n(s);case"unique":return new a(s);case"password-confirm":return new o(s);case"string-length":return new i(s);case"date":return new e(s);case"phone":return new r(s);default:throw new Error("Unfinded validator: "+s.type)}}return u(s)}return s}(),this.hexForm=function(){function t(t){var e=this;e.type=void 0,e.valid=!0,e.name=void 0;var n,a,r,i,o=[],s=t.form;e.tabPanelId=void 0;var u,c=[],d={},l={};e.setValid=function(){r.removeClass("has-error"),a.find("span").removeClass("active")};var v=function(t){return function(e,n){return"number"==typeof e[t]?e[t]-n[t]:e[t]<n[t]?-1:e[t]>n[t]?1:0}},f=function(){var t=0;a.find("span").removeClass("active");for(var i in c)if(c.hasOwnProperty(i)){var o=c[i],u=e.getValue(),d=o.isValid(u);if(d===!1||"false"===d){t++,a.find("span.error-"+o.getClassName()).addClass("active");break}}if(t>0?(e.valid=!1,r.addClass("has-error")):(r.removeClass("has-error"),e.valid=!0),void 0!==n){var l=!0;for(var v in s.controls)if(s.controls.hasOwnProperty(v)){var f=s.controls[v];if(f.tabPanelId===e.tabPanelId&&f.valid===!1){l=!1;break}}l===!0?n.removeClass("has-error"):n.addClass("has-error")}return e.valid};e.validate=function(t){return void 0===t?f():"blur"===t.type?f():(void 0!==i&&clearTimeout(i),void(i=setTimeout(f,500)))},e.trigger=function(t){for(var e=0;e<o.length;e++)o[e].trigger(t)};var p=function(t){for(var e={},n=t[0].attributes,a=n.length,r=0;a>r;r++)e[n[r].name.toLowerCase()]=n[r].value;return e},h=function(t,e,n){var a={input:n,type:t};void 0!==e&&""!==e&&$.extend(a,jQuery.parseJSON(e));var r=new HexValidator(a),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(l[i[o]]=!0);c.push(r)},m=function(t,n,a){var r={input:a,type:t,control:e};void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),d[t]=new HexWidget(r)};e.addInput=function(t){o.push(t);var n=p(t);for(var a in n)if(n.hasOwnProperty(a)){if("required"===a)h("required",n[a],t);else{var r=a.match(/^data-hex-validator-(.*)$/i);null!==r&&void 0!==r[1]&&h(r[1],n[a],t)}var i=a.match(/^data-hex-widget-(.*)$/i);null!==i&&void 0!==i[1]&&m(i[1],n[a],t)}for(var s in l)l.hasOwnProperty(s)&&t.bind(s,e.validate);c.sort(v("weight"))},e.getValue=function(){switch(e.type){case"text":default:if(void 0!==d.date){var t=o[0].data("daterangepicker");if(void 0===t)return o[0].val();if(""===o[0].val())return!1;var n="";if(n+=t.startDate.format("YYYY-MM-DD"),t.singleDatePicker===!1){var a=t.endDate.format("YYYY-MM-DD");n+=" - "+a}return n}return void 0!==d.fileupload||void 0!==d.filesimple?u:o[0].val();case"radio":for(var r in o)if(o.hasOwnProperty(r)&&o[r].is(":checked")===!0)return o[r].val();return!1;case"checkbox":return o[0].is(":checked")===!0?e.trueValue:e.falseValue}},e.setValue=function(t){u=t};var g=function(t){if(void 0!==t.type&&(e.type=t.type,"checkbox"===t.type&&(e.trueValue=!0,e.falseValue=!1)),void 0!==t.form&&(s=t.form),e.name=t.name,void 0!==t.inputs)for(var i in t.inputs)t.inputs.hasOwnProperty(i)&&e.addInput(t.inputs[i]);r=o[0].closest("div.form-group"),a=r.find(".errors");var u=r.closest(".tab-pane");if(u.size()>0){var c=u.attr("id"),d=$('.nav a[href="#'+c+'"]');d.size()>0&&(n=d),e.tabPanelId=c}e.setValid()};g(t)}function e(e){function n(t,e){t.attr("data-hex-multy-item",e),t.find('input[type!="submit"],select,textarea').each(function(){$(this).val("");var t=$(this).attr("name");t=t.replace(/\[\d+\]/g,function(t){return"["+e+"]"}),$(this).attr("name",t)})}var a=this;a.controls={};var r=e,i={},o=function(t){this.type=t,this.stoped=!1,this.stop=function(){this.stoped=!0}};a.on=function(t,e){void 0===i[t]&&(i[t]=[]),i[t].push(e)},a.off=function(t,e){void 0!==i[t]&&i[t].splice(i[t].indexOf(e),1)},a.fire=function(t,e){var n=new o(t);if(void 0!==i[t])for(var a in i[t]){var r=i[t][a];r(e,n)}return!n.stoped};var s=function(t){$.each(t.find('input[type!="submit"],select,textarea'),function(t,e){var n=$(e),r=n.attr("name");void 0!==a.controls[r]&&delete a.controls[r]})},u=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,n){var r=$(n),i=r.attr("name"),o=r.prop("tagName").toLowerCase();switch(o){case"select":case"textarea":a.controls[i]=new t({type:o,inputs:[r],form:a,name:i});break;case"input":var s=r.attr("type").toLowerCase();switch(s){default:a.controls[i]=new t({type:s,inputs:[r],form:a,name:i});break;case"checkbox":var u=new t({type:"checkbox",inputs:[r],form:a,name:i});void 0!==r.attr("value")&&(u.trueValue=r.attr("value")),void 0!==r.attr("data-hex-true-value")&&(u.trueValue=r.attr("data-hex-true-value")),void 0!==r.attr("data-hex-false-value")&&(u.falseValue=r.attr("data-hex-false-value")),a.controls[i]=u;break;case"radio":void 0===a.controls[i]?a.controls[i]=new t({type:"radio",inputs:[r],form:a,name:i}):a.controls[i].addInput(r)}}})},c=function(){var t={};for(var e in a.controls)if(a.controls.hasOwnProperty(e)){var n=a.controls[e].name;t[n]=a.controls[e].getValue()}return t},d=function(t){var e=a.fire("beforeReset",{values:a.getValues()});e?window.setTimeout(function(){for(var t in a.controls)a.controls.hasOwnProperty(t)&&a.controls[t].trigger("change")},1):t.preventDefault(),a.fire("afterReset",{})},l=function(){r.find(".has-error").removeClass("has-error"),r.find(".alerts div").remove()},v=function(t){t.preventDefault(),t.stopPropagation();var e=!0;for(var n in a.controls)a.controls.hasOwnProperty(n)&&a.controls[n].validate(void 0)===!1&&(e=!1);if(e===!0){l();var i=c(),o=a.fire("beforeSubmit",{values:i});if(o){a.loaderShow();var s=r.attr("action"),u=r.find("button[type=submit]:focus");u.size()>0&&void 0!==u.attr("data-action")&&(s=u.attr("data-action"));var d="POST";void 0!==r.attr("method")&&(d=r.attr("method"));var v=new FormData;$.each(i,function(t,e){v.append(t,e)}),$.ajax({url:s,data:v,type:d,dataType:"json",processData:!1,contentType:!1,success:function(t){if(a.loaderHide(),t.success===!0&&(l(),void 0!==t.reload&&(t.reload===!0?window.location.href=window.location.href:window.location.href=t.reload)),void 0!==t.alerts)for(var e in t.alerts){var n=t.alerts[e];r.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}},error:function(t,e,n){a.loaderHide()}})}}return!1};a.loaderShow=function(){r.find(".loader").show()},a.loaderHide=function(){r.find(".loader").hide()},a.submit=function(){v()},a.getValues=function(){return c()};var f=function(){r.addClass("loader-container").append('<div class="loader"></div>'),r.bind("submit",v),r.bind("reset",d),0===r.find(".loader").size()&&r.append('<div class="loader"></div>'),u(r),r.find("div[data-hex-multy]").on("click","button[data-hex-multy-add]",function(){var t=$(this).closest("div[data-hex-multy]"),e=t.find("[data-hex-multy-item]").last(),a=(parseInt(e.attr("data-hex-multy-item")),$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]")),r=a.size(),i=e.clone(!1);n(i,r),u(i),i.insertAfter(e)}),r.find("div[data-hex-multy]").on("click","button[data-hex-multy-remove]",function(){var t=$(this).closest("[data-hex-multy-item]"),e=parseInt(t.attr("data-hex-multy-item")),a=$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]");s(t),t.remove(),a.each(function(t,a){t>e&&n($(this),--t)})})};return f(),a}function n(t){if(void 0!==t)return void 0===a[t]&&(a[t]=new e($("#"+t))),a[t];var n=$("form.hex-form");return n.each(function(){var t=$(this).attr("id");if(void 0===t)throw new Error("Form dont have id attr");a[t]=new e($(this))}),a}var a={};return n}();