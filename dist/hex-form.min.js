"use strict";this.HexWidget=function(){function e(e){function t(e){void 0!==e.input&&(r=e.input,n=r.closest(".form-group").find("button.password-show"),n.bind("click",function(e){return e.preventDefault(),"password"===a?(r.attr("type","text"),n.addClass("active"),a="text"):(r.attr("type","password"),n.removeClass("active"),a="password"),r.focus(),!1}))}var n,r,a="password";t(e)}function t(e){function t(e){return s=e.length>8?1:0,u=e.match(l)?1:0,c=e.match(f)?1:0,d=e.match(p)?1:0,v=e.match(h)?1:0,s+u+c+d+v}function n(e){void 0!==e.events&&i.setEvents(e.events),void 0!==e.input&&(r=e.input,a=r.closest(".form-group").find(".password-strength div"),r.bind("keyup change",function(){var e=r.val();a.attr("class","s-"+t(e))}))}var r,a,i=this,o=["change"],s=0,u=0,c=0,d=0,v=0,l=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(e){o=e},i.getEvents=function(){return o},n(e)}function n(e){function t(e){if(void 0!==e.input){n=e.input;var t=moment.localeData(),r={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:t.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:t.firstDayOfWeek()}};$.extend(r,e);var a=r.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");r.singleDatePicker===!1&&(a+=r.locale.separator+a),n.inputmask(a),n.daterangepicker(r,function(e,t){var a=e.format(r.locale.format);r.singleDatePicker===!1&&(a+=r.locale.separator+t.format(r.locale.format)),n.val(a),n.trigger("blur")})}}var n;t(e)}function r(e){function t(e){if(void 0!==e.input){n=e.input;var t={theme:"bootstrap"};$.extend(t,e),n.select2(t)}}var n;t(e)}function a(e){function t(e){if(void 0!==e.input){n=e.input;var t={};$.extend(t,e),n.fileupload({url:t.url,dataType:"json",formData:function(){return{}},paramName:"files[]",done:function(e,t){$.each(t.result.files,function(e,t){$("<p/>").text(t.name).appendTo("#files")})},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",n+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}}var n;t(e)}function i(e){function t(e){void 0!==e.input&&(n=e.input,n.inputmask("+7(999)999-99-99"))}var n;t(e)}function o(o){function s(o){switch(o.type){case"password-strength":return new t(o);case"password-show":return new e(o);case"date":return new n(o);case"phone":return new i(o);case"select2":return new r(o);case"fileupload":return new a(o);default:throw new Error("Unfinded widget: "+o.type)}}return s(o)}return o}(),this.HexValidator=function(){function e(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,r=["blur"];n.weight=0;var a="required";n.getClassName=function(){return a},n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){return e===!1||void 0===e||""===e?!1:!0},t(e)}function t(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.input&&(a=e.input)}var n=this,r=["change","keyup","blur"];n.weight=3;var a,i="date";n.getClassName=function(){return i},n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){if(""===e||void 0===e||e===!1)return!0;var t=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:t})},t(e)}function n(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,r="email";n.getClassName=function(){return r};var a=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){return""===e||void 0===e||e===!1?!0:i.test(e)},t(e)}function r(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.url&&(a=e.url)}var n=this,r="unique";n.getClassName=function(){return r};var a,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(e){s=e},n.getEvents=function(){return s},n.isValid=function(e){if(o!==!1&&o.abort(),i!==e){o=$.ajax({url:a,data:{value:e},method:"POST",async:!1});var t=o.responseText;return i="true"===t?e:!1,t}return!0},t(e)}function a(e){function t(e){void 0!==e.events&&r.setEvents(e.events),void 0!==e.input&&(n=e.input)}var n,r=this,a="phone",i=["blur"];r.getClassName=function(){return a},r.weight=4,r.setEvents=function(e){i=e},r.getEvents=function(){return i},r.isValid=function(){var e=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:e})},t(e)}function i(e){function t(e){void 0!==e.min&&(n=e.min),void 0!==e.max&&(r=e.max),void 0!==e.events&&a.setEvents(e.events)}var n,r,a=this,i="string-length";a.getClassName=function(){return i};var o=["change","keyup","blur"];a.weight=3,a.setEvents=function(e){o=e},a.getEvents=function(){return o},a.isValid=function(e){var t=e.length;return void 0!==n&&n>t?(i="string-length-min",!1):void 0!==r&&t>r?(i="string-length-max",!1):!0},t(e)}function o(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.password&&(i=$(e.password))}var n=this,r="password-confirm";n.getClassName=function(){return r};var a=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){return i.val()===e},t(e)}function s(s){function u(s){switch(s.type){case"required":return new e(s);case"email":return new n(s);case"unique":return new r(s);case"password-confirm":return new o(s);case"string-length":return new i(s);case"date":return new t(s);case"phone":return new a(s);default:throw new Error("Unfinded validator: "+s.type)}}return u(s)}return s}(),this.hexForm=function(){function e(e){var t=this;t.type=void 0,t.valid=!0,t.name=void 0;var n,r,a,i,o=[],s=e.form;t.tabPanel=void 0;var u=[],c={},d={},v=function(e){return function(t,n){return"number"==typeof t[e]?t[e]-n[e]:t[e]<n[e]?-1:t[e]>n[e]?1:0}},l=function(){var e=0;r.find("span").removeClass("active");for(var i in u)if(u.hasOwnProperty(i)){var o=u[i],c=t.getValue(),d=o.isValid(c);if(d===!1||"false"===d){e++,r.find("span.error-"+o.getClassName()).addClass("active");break}}if(e>0?(t.valid=!1,a.addClass("has-error")):(a.removeClass("has-error"),t.valid=!0),void 0!==n){var v=!0;for(var l in s.controls)if(s.controls.hasOwnProperty(l)){var f=s.controls[l];if(f.tabPanel===t.tabPanel&&f.valid===!1){v=!1;break}}v===!0?n.removeClass("has-error"):n.addClass("has-error")}return t.valid};t.validate=function(e){return void 0===e?l():"blur"===e.type?l():(void 0!==i&&clearTimeout(i),void(i=setTimeout(l,500)))},t.trigger=function(e){for(var t=0;t<o.length;t++)o[t].trigger(e)};var f=function(e){for(var t={},n=e[0].attributes,r=n.length,a=0;r>a;a++)t[n[a].name.toLowerCase()]=n[a].value;return t},p=function(e,t,n){var r={input:n,type:e};void 0!==t&&""!==t&&$.extend(r,jQuery.parseJSON(t));var a=new HexValidator(r),i=a.getEvents();for(var o in i)i.hasOwnProperty(o)&&(d[i[o]]=!0);u.push(a)},h=function(e,t,n){var r={input:n,type:e};void 0!==t&&""!==t&&$.extend(r,jQuery.parseJSON(t)),c[e]=new HexWidget(r)};t.addInput=function(e){o.push(e);var n=f(e);for(var r in n)if(n.hasOwnProperty(r)){if("required"===r)p("required",n[r],e);else{var a=r.match(/^data-hex-validator-(.*)$/i);null!==a&&void 0!==a[1]&&p(a[1],n[r],e)}var i=r.match(/^data-hex-widget-(.*)$/i);null!==i&&void 0!==i[1]&&h(i[1],n[r],e)}for(var s in d)d.hasOwnProperty(s)&&e.bind(s,t.validate);u.sort(v("weight"))},t.getValue=function(){switch(t.type){case"text":default:if(void 0!==c.date){var e=o[0].data("daterangepicker");if(void 0===e)return o[0].val();if(""===o[0].val())return!1;var n="";if(n+=e.startDate.format("YYYY-MM-DD"),e.singleDatePicker===!1){var r=e.endDate.format("YYYY-MM-DD");n+=" - "+r}return n}return o[0].val();case"radio":for(var a in o)if(o.hasOwnProperty(a)&&o[a].is(":checked")===!0)return o[a].val();return!1;case"checkbox":return o[0].is(":checked")===!0?t.trueValue:t.falseValue}};var m=function(e){if(void 0!==e.type&&(t.type=e.type,"checkbox"===e.type&&(t.trueValue=!0,t.falseValue=!1)),void 0!==e.form&&(s=e.form),t.name=e.name,void 0!==e.inputs)for(var i in e.inputs)e.inputs.hasOwnProperty(i)&&t.addInput(e.inputs[i]);if(a=o[0].closest("div.form-group"),r=a.find(".errors"),t.tabPanel=o[0].closest(".tab-pane"),t.tabPanel.size()>0){var u=t.tabPanel.attr("id"),c=$('.nav a[href="#'+u+'"]');c.size()>0&&(n=c)}};m(e)}function t(t){var n=this;n.controls=[];var r=t,a={},i=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};n.on=function(e,t){void 0===a[e]&&(a[e]=[]),a[e].push(t)},n.off=function(e,t){void 0!==a[e]&&a[e].splice(a[e].indexOf(t),1)},n.fire=function(e,t){var n=new i(e);if(void 0!==a[e])for(var r in a[e]){var o=a[e][r];o(t,n)}return!n.stoped};var o=function(){$.each(r.find('input[type!="submit"],select,textarea'),function(t,r){var a=$(r),i=a.prop("tagName").toLowerCase();switch(i){case"textarea":n.controls.push(new e({type:"textarea",inputs:[a],form:n,name:a.attr("name")}));break;case"select":n.controls.push(new e({type:"select",inputs:[a],form:n,name:a.attr("name")}));break;case"input":var o=a.attr("type").toLowerCase();switch(o){default:n.controls.push(new e({type:o,inputs:[a],form:n,name:a.attr("name")}));break;case"checkbox":var s=new e({type:"checkbox",inputs:[a],form:n,name:a.attr("name")});void 0!==a.attr("value")&&(s.trueValue=a.attr("value")),void 0!==a.attr("data-hex-true-value")&&(s.trueValue=a.attr("data-hex-true-value")),void 0!==a.attr("data-hex-false-value")&&(s.falseValue=a.attr("data-hex-false-value")),n.controls.push(s);break;case"radio":void 0===n.controls[a.attr("name")]?n.controls[a.attr("name")]=new e({type:"radio",inputs:[a],form:n,name:a.attr("name")}):n.controls[a.attr("name")].addInput(a)}}})},s=function(){var e={};for(var t in n.controls)if(n.controls.hasOwnProperty(t)){var r=n.controls[t].name;e[r]=n.controls[t].getValue()}return e},u=function(e){var t=n.fire("beforeReset",{values:n.getValues()});t?window.setTimeout(function(){for(var e in n.controls)n.controls.hasOwnProperty(e)&&n.controls[e].trigger("change")},1):e.preventDefault(),n.fire("afterReset",{})},c=function(){r.find(".has-error").removeClass("has-error"),r.find(".alerts div").remove()},d=function(e){e.preventDefault();var t=!0;for(var a in n.controls)n.controls.hasOwnProperty(a)&&n.controls[a].validate(void 0)===!1&&(t=!1);if(t===!0){c();var i=s(),o=n.fire("beforeSubmit",{values:i});if(o){n.loaderShow();var u=r.attr("action"),d=r.find("button[type=submit]:focus");d.size()>0&&void 0!==d.attr("data-action")&&(u=d.attr("data-action"));var v="POST";void 0!==r.attr("method")&&(v=r.attr("method")),$.ajax({url:u,data:i,type:v,dataType:"json",success:function(e){if(n.loaderHide(),e.success===!0&&(c(),void 0!==e.reload&&(e.reload===!0?window.location.href=window.location.href:window.location.href=e.reload)),void 0!==e.alerts)for(var t in e.alerts){var a=e.alerts[t];r.find(".alerts").append($("<div>").addClass("alert alert-"+a.type).html(a.text))}},error:function(e,t,r){n.loaderHide()}})}}return!1};n.loaderShow=function(){r.find(".loader").show()},n.loaderHide=function(){r.find(".loader").hide()},n.submit=function(){d()},n.getValues=function(){return s()};var v=function(){r.addClass("loader-container").append('<div class="loader"></div>'),r.bind("submit",d),r.bind("reset",u),0===r.find(".loader").size()&&r.append('<div class="loader"></div>'),o()};return v(),n}function n(e){if(void 0!==e)return void 0===r[e]&&(r[e]=new t($("#"+e))),r[e];var n=$("form.hex-form");return n.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");r[e]=new t($(this))}),r}var r={};return n}();