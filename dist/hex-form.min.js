var HexWidget=function(e,t){"use strict";function a(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!0:!1}function n(e){function t(e){void 0!==e.input&&(n=e.input,a=n.closest(".form-group").find("button.password-show"),a.bind("click",function(e){return e.preventDefault(),"password"===r?(n.attr("type","text"),a.addClass("active"),r="text"):(n.attr("type","password"),a.removeClass("active"),r="password"),n.focus(),!1}))}var a,n,r="password";t(e)}function r(e){function t(e){return s=e.length>8?1:0,u=e.match(f)?1:0,d=e.match(v)?1:0,l=e.match(p)?1:0,c=e.match(h)?1:0,s+u+d+l+c}function a(e){void 0!==e.events&&i.setEvents(e.events),void 0!==e.input&&(n=e.input,r=n.closest(".form-group").find(".password-strength div"),n.bind("keyup change",function(){var e=n.val();r.attr("class","s-"+t(e))}))}var n,r,i=this,o=["change"],s=0,u=0,d=0,l=0,c=0,f=new RegExp("[A-ZА-Я]"),v=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(e){o=e},i.getEvents=function(){return o},a(e)}function i(e){function t(e){if(void 0!==e.input){a=e.input;var t=moment.localeData(),n={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:t.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:t.firstDayOfWeek()}};$.extend(n,e),void 0!==n.timePicker&&n.timePicker===!0&&void 0!==n.timePicker24Hour&&n.timePicker24Hour===!0&&(n.locale.format+=" HH:mm");var r=n.locale.format.replace(/[H]/g,"9").replace(/[m]/g,"9").replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");n.singleDatePicker===!1&&(r+=n.locale.separator+r),a.inputmask(r),a.daterangepicker(n,function(e,t){var r=e.format(n.locale.format);n.singleDatePicker===!1&&(r+=n.locale.separator+t.format(n.locale.format)),a.val(r),a.trigger("blur")})}}var a;t(e)}function o(e){function t(e){if(console.log("select2 init"),void 0!==e.control&&(r=e.control),void 0!==e.input){n=e.input;var t=e.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:t};if(void 0!==e.url){i="ajax";var s=n.find("option[selected]");if(e.ajax={url:e.url,method:"POST",dataType:"json",delay:250,data:function(e){return{search:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.rows,pagination:{more:t.page*e.limit<e.total}}},cache:!1},delete e.url,void 0!==e.parent){var u=e.parent.selector,d=e.parent.param||"parent_id";a($(u).val())&&(r.disable(),n.val("").trigger("change")),$(u).on("change",function(){a($(this).val())?(r.disable(),n.val("").trigger("change")):r.enable()}),delete e.parent;var l=function(){return $(u).val()};e.ajax.data=function(e){var t={search:e.term,page:e.page};return t[d]=l,t}}}$.extend(o,e),n.select2(o),"ajax"===i&&(s.each(function(){n.append($(this))}),n.trigger("change"))}}var n,r,i="local";t(e)}function s(e){function t(e){function t(e){r=e.target.files[0],n.setValue(r)}a=e.input,n=e.control,a.bind("change",t)}var a,n,r;t(e)}function u(e){function t(e){a=e.input,a.inputmask(e.mask)}var a;t(e)}function d(e){function t(e){void 0!==e.input&&(a=e.input,a.inputmask("+7(999)999-99-99"))}var a;t(e)}function l(e){function t(e){switch(e.type){case"password-strength":return new r(e);case"password-show":return new n(e);case"date":return new i(e);case"phone":return new d(e);case"select2":return new o(e);case"mask":return new u(e);case"filesimple":return new s(e);default:throw new Error("Unfinded widget: "+e.type)}}return t(e)}return l}(window,document),HexValidator=function(){"use strict";function e(e){function t(e){void 0!==e.events&&a.setEvents(e.events)}var a=this,n=["blur","change"];a.weight=0;var r="required";a.getClassName=function(){return r},a.setEvents=function(e){n=e},a.getEvents=function(){return n},a.isValid=function(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!1:!0},t(e)}function t(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.input&&(r=e.input)}var a=this,n=["change","keyup","blur"];a.weight=3;var r,i="date";a.getClassName=function(){return i},a.setEvents=function(e){n=e},a.getEvents=function(){return n},a.isValid=function(e){if(""===e||void 0===e||e===!1)return!0;var t=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:t})},t(e)}function a(e){function t(e){void 0!==e.events&&a.setEvents(e.events)}var a=this,n="email";a.getClassName=function(){return n};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;a.weight=1,a.setEvents=function(e){r=e},a.getEvents=function(){return r},a.isValid=function(e){return""===e||void 0===e||e===!1?!0:i.test(e)},t(e)}function n(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.url&&(r=e.url)}var a=this,n="unique";a.getClassName=function(){return n};var r,i=!1,o=!1,s=["change","keyup","blur"];a.weight=5,a.setEvents=function(e){s=e},a.getEvents=function(){return s},a.isValid=function(e){if(o!==!1&&o.abort(),i!==e){o=$.ajax({url:r,data:{value:e},method:"POST",async:!1});var t=o.responseText;return i="true"===t?e:!1,t}return!0},t(e)}function r(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.input&&(a=e.input)}var a,n=this,r="phone",i=["blur"];n.getClassName=function(){return r},n.weight=4,n.setEvents=function(e){i=e},n.getEvents=function(){return i},n.isValid=function(e){if(""===e||void 0===e||e===!1||null===e)return!0;var t=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:t})},t(e)}function i(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.input&&(a=e.input)}var a,n=this,r="mask",i=["blur"];n.getClassName=function(){return r},n.weight=4,n.setEvents=function(e){i=e},n.getEvents=function(){return i},n.isValid=function(e){if(""===e||void 0===e||e===!1||null===e)return!0;var t=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:t})},t(e)}function o(e){function t(e){void 0!==e.min&&(a=e.min),void 0!==e.max&&(n=e.max),void 0!==e.events&&r.setEvents(e.events)}var a,n,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(e){o=e},r.getEvents=function(){return o},r.isValid=function(e){var t=e.length;return void 0!==a&&a>t?(i="string-length-min",!1):void 0!==n&&t>n?(i="string-length-max",!1):!0},t(e)}function s(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.password&&(i=$(e.password))}var a=this,n="password-confirm";a.getClassName=function(){return n};var r=["change","keyup","blur"];a.weight=4;var i;a.setEvents=function(e){r=e},a.getEvents=function(){return r},a.isValid=function(e){return i.val()===e},t(e)}function u(u){function d(u){switch(u.type){case"required":return new e(u);case"email":return new a(u);case"unique":return new n(u);case"password-confirm":return new s(u);case"string-length":return new o(u);case"date":return new t(u);case"phone":return new r(u);case"mask":return new i(u);default:throw new Error("Unfinded validator: "+u.type)}}return d(u)}return u}(),hexForm=function(e,t){"use strict";function a(e){function t(e){return function(t,a){return"number"==typeof t[e]?t[e]-a[e]:t[e]<a[e]?-1:t[e]>a[e]?1:0}}var a=this;a.type=void 0,a.valid=!0,a.name=void 0;var n,r,i=[],o=e.form;a.formGroup=void 0,a.panels=[],a.tabs=[];var s,u=[],d={},l={};a.disabled=!1,a.readonly=!1,a.setValid=function(){a.formGroup.removeClass("has-error"),n.find("span").removeClass("active")},a.enable=function(){for(var e in i)i[e].prop("disabled",!1);a.disabled=!1},a.disable=function(){for(var e in i)i[e].prop("disabled",!0);a.disabled=!0},a.addReadonly=function(){for(var e in i)i[e].prop("readonly",!0);a.readonly=!0},a.removeReadonly=function(){for(var e in i)i[e].prop("readonly",!1);a.readonly=!1};var c=function(){var e=0;if(n.find("span").removeClass("active"),!a.disabled)for(var t in u)if(u.hasOwnProperty(t)){var r=u[t],i=a.getValue(),s=r.isValid(i);if(s===!1||"false"===s){e++,n.find("span.error-"+r.getClassName()).addClass("active");break}}if(e>0?(a.valid=!1,a.formGroup.addClass("has-error")):(a.formGroup.removeClass("has-error"),a.valid=!0),a.panels.length>0){var d=!0;if(a.valid===!0){for(var l in o.controls)if(o.controls.hasOwnProperty(l)){var c=o.controls[l];if(c.valid===!1)for(var f in c.panels){var v=c.panels[f];for(var p in a.panels)if(v===a.panels[p]){d=!1;break}}}}else d=!1;d===!0?$.each(a.tabs,function(e,t){t.removeClass("has-error")}):$.each(a.tabs,function(e,t){t.addClass("has-error")})}return a.valid};a.validate=function(e){return void 0===e?c():"blur"===e.type?c():(void 0!==r&&clearTimeout(r),void(r=setTimeout(c,500)))},a.trigger=function(e){for(var t=0;t<i.length;t++)i[t].trigger(e)},a.addEvent=function(e,t){for(var a=0;a<i.length;a++)i[a].bind(e,t)};var f=function(e){for(var t={},a=e[0].attributes,n=a.length,r=0;n>r;r++)t[a[r].name.toLowerCase()]=a[r].value;return t},v=function(e,t,a){var n={input:a,type:e};void 0!==t&&""!==t&&$.extend(n,jQuery.parseJSON(t));var r=new HexValidator(n),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(l[i[o]]=!0);u.push(r)},p=function(e,t,n){var r={input:n,type:e,control:a};void 0!==t&&""!==t&&$.extend(r,jQuery.parseJSON(t)),d[e]=new HexWidget(r)};a.addInput=function(e){i.push(e);var n=f(e);for(var r in n)if(n.hasOwnProperty(r)){if("required"===r)v("required",n[r],e);else{var o=r.match(/^data-hex-validator-(.*)$/i);null!==o&&void 0!==o[1]&&v(o[1],n[r],e)}var s=r.match(/^data-hex-widget-(.*)$/i);null!==s&&void 0!==s[1]&&p(s[1],n[r],e)}for(var d in l)l.hasOwnProperty(d)&&e.bind(d,a.validate);u.sort(t("weight")),e.prop("disabled")&&a.disable(),e.prop("readonly")&&a.addReadonly(),e.bind("disable",function(){a.disable()}),e.bind("enable",function(){a.enable()})},a.getValue=function(){switch(a.type){case"text":default:if(void 0!==d.date){var e=i[0].data("daterangepicker");if(void 0===e)return i[0].val();if(""===i[0].val())return!1;var t="",n="YYYY-MM-DD";if(e.timePicker===!0&&(n+=" HH:mm"),t+=e.startDate.format(n),e.singleDatePicker===!1){var r=e.endDate.format(n);t+=" - "+r}return t}return void 0!==d.fileupload||void 0!==d.filesimple?s:i[0].val();case"radio":for(var o in i)if(i.hasOwnProperty(o)&&i[o].is(":checked")===!0)return i[o].val();return!1;case"checkbox":return i[0].is(":checked")===!0?a.trueValue:a.falseValue}},a.setValue=function(e){s=e};var h=function(e){if(void 0!==e.type&&(a.type=e.type,"checkbox"===e.type&&(a.trueValue=!0,a.falseValue=!1)),void 0!==e.form&&(o=e.form),a.name=e.name,void 0!==e.inputs)for(var t in e.inputs)e.inputs.hasOwnProperty(t)&&a.addInput(e.inputs[t]);a.formGroup=i[0].closest("div.form-group"),n=a.formGroup.find(".errors"),a.formGroup.parents('[role="tabpanel"]').size()>0&&a.formGroup.parents('[role="tabpanel"]').each(function(){var e=$(this),t=e.attr("id");a.panels.push(t);var n=$('.nav a[href="#'+t+'"]');n.size()>0&&a.tabs.push(n)}),a.setValid()};h(e)}function n(n){function r(e){function t(e,t){if(void 0!==e.attr("data-hex-multy-item")&&e.attr("data-hex-multy-item",t),void 0!==e.attr("data-hex-multy-tab")){e.attr("data-hex-multy-tab",t);var a=e.find("a");if(a.attr("href",a.attr("href").replace(/\d+/g,t)),a.attr("aria-controls",a.attr("aria-controls").replace(/\d+/g,t)),a.find("[data-hex-multy-tab-label]").size()>0){var n=a.find("[data-hex-multy-tab-label]").html();n=n.replace(/\d+/g,t+1),a.find("[data-hex-multy-tab-label]").html(n)}}if(void 0!==e.attr("id")){var r=e.attr("id");e.attr("id",r.replace(/\d+/,t))}e.find('input[type!="submit"],select,textarea').each(function(){var e=$(this).attr("name");void 0!==e&&(e=e.replace(/\[\d+\]/g,function(){return"["+t+"]"}),$(this).attr("name",e))})}function a(){if(o===!1){var t=e.find("[data-hex-multy-item]");t.size()<=1?e.find("[data-hex-multy-remove]").attr("disabled","disabled"):e.find("[data-hex-multy-remove]").removeAttr("disabled")}}var n,r,i=e.data("hex-multy"),o=!1;void 0!==i.allow_empty&&i.allow_empty===!0&&(o=!0),e.find("[data-hex-multy-tabs]").size()>0&&(n=e.find("[data-hex-multy-tabs]"),r=n.find('[data-hex-multy-tab="$"]').clone(!1),n.find('[data-hex-multy-tab="$"]').remove());var s=e.find('[data-hex-multy-item="$"]'),u=s.clone(!1);s.remove(),u.find('input[type!="submit"],select,textarea').each(function(){$(this).val("")}),e.on("click","[data-hex-multy-add]",function(){var a=$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]"),i=a.size(),o=u.clone(!1);if(o.find("[data-hex-multy-hide]").remove(),o.find("[data-hex-multy-attr]").each(function(){var e=$(this),t=e.data("hex-multy-attr");if(void 0!==t.add&&$.each(t.add,function(t,a){for(var n in a)e.attr(n,a[n])}),void 0!==t.remove)for(var a in t.remove)e.removeAttr(t.remove[a])}),t(o,i),o.appendTo(e.find("[data-hex-multy-items]")),void 0!==n){var s=r.clone(!1);t(s,i),n.append(s)}f(o),void 0!==n&&$('a[href="#'+o.attr("id")+'"]').trigger("click")}),e.on("click","[data-hex-multy-remove]",function(){var r=$(this).closest("[data-hex-multy-item]"),i=parseInt(r.attr("data-hex-multy-item")),o=e.find("[data-hex-multy-item]");c(r),r.remove(),o.each(function(){$(this).attr("data-hex-multy-item")>i&&t($(this),$(this).attr("data-hex-multy-item")-1)}),void 0!==n&&(n.find('[data-hex-multy-tab="'+i+'"]').remove(),n.find("[data-hex-multy-tab]").each(function(){$(this).attr("data-hex-multy-tab")>i&&t($(this),$(this).attr("data-hex-multy-tab")-1)}),n.find('a[role="tab"]:first').trigger("click")),a()}),a()}function i(e){function t(){r.getValue()!==n?(e.hide(),e.find('input[type!="submit"],select,textarea').trigger("disable")):(e.show(),e.find('input[type!="submit"],select,textarea').trigger("enable"))}var a=e.data("hexDisabled"),n=a.value,r=o.controls[a.control];r.addEvent("change",t),r.trigger("change")}var o=this;o.controls={};var s=n,u=s.attr("id"),d={},l=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};o.on=function(e,t){void 0===d[e]&&(d[e]=[]),d[e].push(t)},o.off=function(e,t){void 0!==d[e]&&d[e].splice(d[e].indexOf(t),1)},o.fire=function(e,t){var a=new l(e);if(void 0!==d[e])for(var n in d[e]){var r=d[e][n];r(t,a)}return!a.stoped};var c=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,t){var a=$(t),n=a.attr("name");void 0!==o.controls[n]&&delete o.controls[n]})},f=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,t){var n=$(t);if(0===n.parents('[data-hex-multy-item="$"]').size()){var r=n.attr("name"),i=n.prop("tagName").toLowerCase();switch(i){case"select":case"textarea":o.controls[r]=new a({type:i,inputs:[n],form:o,name:r});break;case"input":var s=n.attr("type").toLowerCase();switch(s){default:o.controls[r]=new a({type:s,inputs:[n],form:o,name:r});break;case"checkbox":var u=new a({type:"checkbox",inputs:[n],form:o,name:r});void 0!==n.attr("value")&&(u.trueValue=n.attr("value")),void 0!==n.attr("data-hex-true-value")&&(u.trueValue=n.attr("data-hex-true-value")),void 0!==n.attr("data-hex-false-value")&&(u.falseValue=n.attr("data-hex-false-value")),o.controls[r]=u;break;case"radio":void 0===o.controls[r]?o.controls[r]=new a({type:"radio",inputs:[n],form:o,name:r}):o.controls[r].addInput(n)}}}})},v=function(){var e={};for(var t in o.controls)if(o.controls.hasOwnProperty(t)&&o.controls[t].disabled===!1){var a=o.controls[t].name,n=o.controls[t].getValue();null===n||$.isArray(n)&&0===n.length?n="":e[a]=n}return e},p=function(t){var a=o.fire("beforeReset",{values:o.getValues()});a?e.setTimeout(function(){for(var e in o.controls)o.controls.hasOwnProperty(e)&&o.controls[e].trigger("change")},1):t.preventDefault(),o.fire("afterReset",{})},h=function(){s.find(".has-error").removeClass("has-error"),s.find(".alerts div").remove()},m=function(t){t.preventDefault(),t.stopPropagation();var a=!0;for(var n in o.controls)o.controls.hasOwnProperty(n)&&o.controls[n].validate(void 0)===!1&&(a=!1);if(a===!0){h();var r=v(),i=o.fire("beforeSubmit",{values:r});if(i){o.loaderShow();var u=s.attr("action"),d=s.find("button[type=submit]:focus");d.size()>0&&void 0!==d.attr("data-action")&&(u=d.attr("data-action"));var l="POST";void 0!==s.attr("method")&&(l=s.attr("method"));var c=new FormData;$.each(r,function(e,t){if($.isArray(t)||$.isPlainObject(t))for(var a in t)null!==t[a]&&t[a]!==!1&&void 0!==t[a]&&c.append(e,t[a]);else c.append(e,t)}),$.ajax({url:u,data:c,type:l,dataType:"json",processData:!1,contentType:!1,success:function(t){if(t.success===!0?(h(),void 0!==t.reload?t.reload===!0?e.location.href=e.location.href:e.location.href=t.reload:o.loaderHide()):o.loaderHide(),void 0!==t.alerts){for(var a in t.alerts){var n=t.alerts[a];s.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}o.loaderHide()}},error:function(e,t,a){o.loaderHide()}})}}return!1};o.loaderShow=function(){s.find(".loader").show()},o.loaderHide=function(){s.find(".loader").hide()},o.submit=function(){m()},o.getValues=function(){return v()};var g=function(){s.addClass("loader-container").append('<div class="loader"></div>'),$(t).on("submit","#"+u,m),$(t).on("reset","#"+u,p),0===s.find(".loader").size()&&s.append('<div class="loader"></div>'),f(s),s.find("[data-hex-multy]").size()>0&&s.find("[data-hex-multy]").each(function(){r($(this))}),s.find("[data-hex-disabled]").size()>0&&s.find("[data-hex-disabled]").each(function(){i($(this))})};return g(),o}function r(e){if(void 0!==e)return void 0===i[e]&&(i[e]=new n($("#"+e))),i[e];var t=$("form.hex-form");return t.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");i[e]=new n($(this))}),i}var i={};return r}(window,document);