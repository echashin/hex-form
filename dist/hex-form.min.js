!function(e){"use strict";var t={widgets:{},validators:{},utils:{}};t.utils.toCamel=function(e){return e.replace(/[-_]([a-z])/g,function(e){return e[1].toUpperCase()})},t.utils.isEmpty=function(e){return!!(null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length)},t.utils.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,a,i,o;return a=2147483648&e,i=2147483648&t,n=1073741824&e,r=1073741824&t,o=(1073741823&e)+(1073741823&t),n&r?2147483648^o^a^i:n|r?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function r(e,t,n){return e&t|~e&n}function a(e,t,n){return e&n|t&~n}function i(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function s(e,a,i,o,s,d,l){return e=n(e,n(n(r(a,i,o),s),l)),n(t(e,d),a)}function d(e,r,i,o,s,d,l){return e=n(e,n(n(a(r,i,o),s),l)),n(t(e,d),r)}function l(e,r,a,o,s,d,l){return e=n(e,n(n(i(r,a,o),s),l)),n(t(e,d),r)}function u(e,r,a,i,s,d,l){return e=n(e,n(n(o(r,a,i),s),l)),n(t(e,d),r)}function c(e){for(var t,n=e.length,r=n+8,a=(r-r%64)/64,i=16*(a+1),o=Array(i-1),s=0,d=0;n>d;)t=(d-d%4)/4,s=d%4*8,o[t]=o[t]|e.charCodeAt(d)<<s,d++;return t=(d-d%4)/4,s=d%4*8,o[t]=o[t]|128<<s,o[i-2]=n<<3,o[i-1]=n>>>29,o}function f(e){var t,n,r="",a="";for(n=0;3>=n;n++)t=e>>>8*n&255,a="0"+t.toString(16),r+=a.substr(a.length-2,2);return r}function v(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var h,p,m,g,x,y,b,k,w,C=[],E=7,$=12,B=17,V=22,D=5,I=9,S=14,O=20,z=4,N=11,P=16,M=23,T=6,j=10,R=15,L=21;for(e=v(e),C=c(e),y=1732584193,b=4023233417,k=2562383102,w=271733878,h=0;h<C.length;h+=16)p=y,m=b,g=k,x=w,y=s(y,b,k,w,C[h+0],E,3614090360),w=s(w,y,b,k,C[h+1],$,3905402710),k=s(k,w,y,b,C[h+2],B,606105819),b=s(b,k,w,y,C[h+3],V,3250441966),y=s(y,b,k,w,C[h+4],E,4118548399),w=s(w,y,b,k,C[h+5],$,1200080426),k=s(k,w,y,b,C[h+6],B,2821735955),b=s(b,k,w,y,C[h+7],V,4249261313),y=s(y,b,k,w,C[h+8],E,1770035416),w=s(w,y,b,k,C[h+9],$,2336552879),k=s(k,w,y,b,C[h+10],B,4294925233),b=s(b,k,w,y,C[h+11],V,2304563134),y=s(y,b,k,w,C[h+12],E,1804603682),w=s(w,y,b,k,C[h+13],$,4254626195),k=s(k,w,y,b,C[h+14],B,2792965006),b=s(b,k,w,y,C[h+15],V,1236535329),y=d(y,b,k,w,C[h+1],D,4129170786),w=d(w,y,b,k,C[h+6],I,3225465664),k=d(k,w,y,b,C[h+11],S,643717713),b=d(b,k,w,y,C[h+0],O,3921069994),y=d(y,b,k,w,C[h+5],D,3593408605),w=d(w,y,b,k,C[h+10],I,38016083),k=d(k,w,y,b,C[h+15],S,3634488961),b=d(b,k,w,y,C[h+4],O,3889429448),y=d(y,b,k,w,C[h+9],D,568446438),w=d(w,y,b,k,C[h+14],I,3275163606),k=d(k,w,y,b,C[h+3],S,4107603335),b=d(b,k,w,y,C[h+8],O,1163531501),y=d(y,b,k,w,C[h+13],D,2850285829),w=d(w,y,b,k,C[h+2],I,4243563512),k=d(k,w,y,b,C[h+7],S,1735328473),b=d(b,k,w,y,C[h+12],O,2368359562),y=l(y,b,k,w,C[h+5],z,4294588738),w=l(w,y,b,k,C[h+8],N,2272392833),k=l(k,w,y,b,C[h+11],P,1839030562),b=l(b,k,w,y,C[h+14],M,4259657740),y=l(y,b,k,w,C[h+1],z,2763975236),w=l(w,y,b,k,C[h+4],N,1272893353),k=l(k,w,y,b,C[h+7],P,4139469664),b=l(b,k,w,y,C[h+10],M,3200236656),y=l(y,b,k,w,C[h+13],z,681279174),w=l(w,y,b,k,C[h+0],N,3936430074),k=l(k,w,y,b,C[h+3],P,3572445317),b=l(b,k,w,y,C[h+6],M,76029189),y=l(y,b,k,w,C[h+9],z,3654602809),w=l(w,y,b,k,C[h+12],N,3873151461),k=l(k,w,y,b,C[h+15],P,530742520),b=l(b,k,w,y,C[h+2],M,3299628645),y=u(y,b,k,w,C[h+0],T,4096336452),w=u(w,y,b,k,C[h+7],j,1126891415),k=u(k,w,y,b,C[h+14],R,2878612391),b=u(b,k,w,y,C[h+5],L,4237533241),y=u(y,b,k,w,C[h+12],T,1700485571),w=u(w,y,b,k,C[h+3],j,2399980690),k=u(k,w,y,b,C[h+10],R,4293915773),b=u(b,k,w,y,C[h+1],L,2240044497),y=u(y,b,k,w,C[h+8],T,1873313359),w=u(w,y,b,k,C[h+15],j,4264355552),k=u(k,w,y,b,C[h+6],R,2734768916),b=u(b,k,w,y,C[h+13],L,1309151649),y=u(y,b,k,w,C[h+4],T,4149444226),w=u(w,y,b,k,C[h+11],j,3174756917),k=u(k,w,y,b,C[h+2],R,718787259),b=u(b,k,w,y,C[h+9],L,3951481745),y=n(y,p),b=n(b,m),k=n(k,g),w=n(w,x);var F=f(y)+f(b)+f(k)+f(w);return F.toLowerCase()},e.hex=t}(window);var hex=function(e){"use strict";return e.Block=function(t,n,r){function a(){var e=[],n={};t.find('input[type!="submit"],select,textarea').each(function(){var t=$(this),n=t.parents('[data-hex-block][data-hex-multy-item!="$"]:first').attr("id");n===o.id&&e.push(t)}),t.find('[data-hex-block][data-hex-multy-item!="$"]').each(function(){var e=$(this);e.parents('[data-hex-block][data-hex-multy-item!="$"]:first').attr("id")===o.id&&(n[e.attr("id")]=e)});for(var r in n)o.addBlock(n[r]);d(e)}function i(){if(o.id=t.attr("id"),o.form=n,o.element=t,o.parent=r,$('[href="#'+o.id+'"]').size()>0&&(s=$('[href="#'+o.id+'"]')),void 0===o.id)throw console.log(t),new Error("[data-hex-block] must have id attr");a()}var o=this;o.element=void 0,o.childBlocks=[],o.controls=[],o.parent=void 0;var s;o.id=void 0,o.valid=!0,o.form=void 0,o.hideErrors=function(){void 0!==s&&s.removeClass("has-error")},o.findBlockById=function(e){if(o.id===e)return o;for(var t in o.childBlocks){var n=o.childBlocks[t].findBlockById(e);if(n!==!1)return n}return!1},o.addBlock=function(t){o.childBlocks.push(new e.Block(t,n,o))},o.showErrors=function(){void 0!==s&&s.addClass("has-error")},o.isValid=function(e){var t=!0;for(var n in o.controls)o.controls[n].isValid(e)||(t=!1);for(var r in o.childBlocks)o.childBlocks[r].isValid(e)||(t=!1);return o.valid=t,void 0!==s&&(t?s.removeClass("has-error"):o.showErrors()),o.valid},o.setValid=function(){},o.getValues=function(){};var d=function(e){var t={};for(var n in e){var r=e[n];if(r.parents('[data-hex-multy-item="$"]').size()<=0){var a,i=r.attr("name"),s=r.closest(".form-group");s.size()<=0?s=void 0:(a=s.find(".errors"),a.size()<=0&&(a=void 0));var d=r.prop("tagName").toLowerCase(),l=d,u={type:l,inputs:[r],formGroup:s,errorsBlock:a,block:o,name:i};switch(d){case"select":case"textarea":break;case"input":switch(l=r.attr("type").toLowerCase()){default:u.type=l;break;case"checkbox":l="checkbox",u.type=l,void 0!==r.attr("value")&&(u.trueValue=r.attr("value")),void 0!==r.attr("data-hex-true-value")&&(u.trueValue=r.attr("data-hex-true-value")),void 0!==r.attr("data-hex-false-value")&&(u.falseValue=r.attr("data-hex-false-value"));break;case"radio":u.type="radio"}}void 0===t[i]?t[i]=u:t[i].inputs.push(r)}}for(var c in t)if(t.hasOwnProperty(c)){var f=new hex.Control(t[c]);o.controls.push(f),o.form.controls.push(f)}};i()},e}(hex),hex=function(e){"use strict";return e.Control=function(t){function n(e){return function(t,n){return"number"==typeof t[e]?t[e]-n[e]:t[e]<n[e]?-1:t[e]>n[e]?1:0}}function r(e){i.push(e);var t=h(e);for(var r in t)if(t.hasOwnProperty(r)){var o=r.match(/^data-hex-widget-(.*)$/i);if(null!==o&&void 0!==o[1]&&m(o[1],t[r]),"required"===r)p("required",t[r]);else{var d=r.match(/^data-hex-validator-(.*)$/i);null!==d&&void 0!==d[1]&&p(d[1],t[r])}}for(var l in f)f.hasOwnProperty(l)&&e.bind(l,v);u.sort(n("weight")),e.prop("disabled")&&a.disable(),e.prop("readonly")&&a.addReadonly(),e.bind("disable",function(){a.disable()}),e.bind("enable",function(){a.enable()}),s=a.getValue()}var a=this;a.type=void 0,a.valid=!0,a.name=void 0;var i=[];a.block=void 0;var o,s,d=[];a.formGroup=void 0;var l,u=[],c={},f={};a.disabled=!1,a.readonly=!1,a.hideErrors=function(){d=[],void 0!==a.formGroup&&a.formGroup.removeClass("has-error"),void 0!==o&&o.find("span").removeClass("active")},a.showErrors=function(){if(void 0!==o)for(var e in d)o.find("span.error-"+d[e]).addClass("active");void 0!==a.formGroup&&a.formGroup.addClass("has-error")},a.reset=function(){a.trigger("change"),a.hideErrors()},a.getWidgets=function(){return c},a.getInputs=function(){return i},a.enable=function(){for(var e in i)i[e].prop("disabled",!1);a.disabled=!1},a.disable=function(){for(var e in i)i[e].prop("disabled",!0);a.disabled=!0,a.valid=!0},a.addReadonly=function(){for(var e in i)i[e].prop("readonly",!0);a.readonly=!0},a.removeReadonly=function(){for(var e in i)i[e].prop("readonly",!1);a.readonly=!1};var v=function(e){if(e===!1)return a.valid;if(a.hideErrors(),!a.disabled)for(var t in u)if(u.hasOwnProperty(t)){var n=u[t],r=n.isValid(a.getValue());if(r===!1||"false"===r){d.push(n.getClassName());break}}return d.length>0?(a.valid=!1,a.showErrors()):(a.valid=!0,a.hideErrors()),void 0!==a.block.form.mainBlock&&a.block.form.mainBlock.isValid(!1),a.valid};a.isValid=function(e){return v(e)},a.trigger=function(e){for(var t=0;t<i.length;t++)i[t].trigger(e)},a.addEvent=function(e,t){for(var n=0;n<i.length;n++)i[n].bind(e,t)};var h=function(e){for(var t={},n=e[0].attributes,r=n.length,a=0;r>a;a++)t[n[a].name.toLowerCase()]=n[a].value;return t},p=function(t,n){var r={};if(t=e.utils.toCamel(t),void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),void 0!==e.validators[t]){var i=new e.validators[t](a,r),o=i.getEvents();for(var s in o)o.hasOwnProperty(s)&&(f[o[s]]=!0);u.push(i)}else console.warn('Validator "'+t+'" not loaded!')},m=function(t,n){t=e.utils.toCamel(t);var r={};void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),void 0!==e.widgets[t]?c[t]=new e.widgets[t](a,r):console.warn('Widget "'+t+'" not loaded!')};a.getValue=function(){switch(a.type){case"text":default:if(void 0!==c.date){var e=i[0].data("daterangepicker");if(void 0===e)return i[0].val();if(""===i[0].val())return!1;var t="",n="YYYY-MM-DD";if(e.timePicker===!0&&(n+=" HH:mm"),t+=e.startDate.format(n),e.singleDatePicker===!1){var r=e.endDate.format(n);t+=" - "+r}return t}return void 0!==c.fileupload||void 0!==c.filesimple?l:i[0].val();case"radio":for(var o in i)if(i.hasOwnProperty(o)&&i[o].is(":checked")===!0)return i[o].val();return!1;case"checkbox":return i[0].is(":checked")===!0?a.trueValue:a.falseValue}},a.setValue=function(e){l=e};var g=function(e){if(void 0!==e.type&&(a.type=e.type,"checkbox"===e.type&&(a.trueValue=!0,a.falseValue=!1,void 0!==e.trueValue&&(a.trueValue=e.trueValue),void 0!==e.falseValue&&(a.falseValue=e.falseValue))),void 0!==e.block&&(a.block=e.block),a.name=e.name,a.formGroup=e.formGroup,o=e.errorsBlock,void 0!==e.inputs)for(var t in e.inputs)e.inputs.hasOwnProperty(t)&&r(e.inputs[t]);a.hideErrors()};g(t)},e}(hex),hex=function(e){"use strict";return e.widgets.passwordShow=function(e){function t(){r=e.getInputs()[0],n=r.closest(".form-group").find("button.password-show"),n.bind("click",function(e){return e.preventDefault(),"password"===a?(r.attr("type","text"),n.addClass("active"),a="text"):(r.attr("type","password"),n.removeClass("active"),a="password"),r.focus(),!1})}var n,r,a="password";t()},e}(hex),hex=function(e){"use strict";return e.widgets.passwordStrength=function(e){function t(e){return o=e.length>8?1:0,s=e.match(c)?1:0,d=e.match(f)?1:0,l=e.match(v)?1:0,u=e.match(h)?1:0,o+s+d+l+u}function n(){r=e.getInputs()[0],a=r.closest(".form-group").find(".password-strength div"),r.bind("keyup change",function(){var e=r.val();a.attr("class","s-"+t(e))})}var r,a,i=this,o=0,s=0,d=0,l=0,u=0,c=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),v=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,n()},e}(hex),hex=function(e){"use strict";var t=$("html").attr("lang");if(e.utils.isEmpty(t))throw new Error("Doesn`t set lang attr in html tag");return moment.locale(t.toLowerCase()),e.widgets.date=function(t,n){function r(){a=t.getInputs()[0];var r=moment.localeData(),l=r.longDateFormat("L");void 0!==n.timePicker&&n.timePicker===!0&&(l+=" "+r.longDateFormat("LT"));var u={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:l,separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:r.firstDayOfWeek()}};void 0!==n.parentMin&&(s=$(n.parentMin).val(),e.utils.isEmpty(s)||(u.minDate=s),i=n.parentMin,delete n.parentMin),void 0!==n.parentMax&&(d=$(n.parentMax).val(),e.utils.isEmpty(d)||(u.maxDate=d),o=n.parentMax,delete n.parentMax),$.extend(u,n);var c=u.locale.format.replace(/[H]/g,"9").replace(/[m]/g,"9").replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");u.singleDatePicker===!1&&(c+=u.locale.separator+c),a.inputmask(c);var f=function(){var e=a.data("daterangepicker"),t=e.startDate.format(u.locale.format);u.singleDatePicker===!1&&(t+=u.locale.separator+e.endDate.format(u.locale.format)),a.val(t).trigger("change")};a.daterangepicker(u),a.on("apply.daterangepicker",function(){f()});var v=function(){d=$(o).val(),e.utils.isEmpty(d)?(t.disable(),a.val("").trigger("change")):(u.maxDate=d,a.daterangepicker(u),a.on("apply.daterangepicker",function(){f()}),t.enable(),e.utils.isEmpty(a.val())&&(e.utils.isEmpty(s)?(a.data("daterangepicker").setStartDate(d),a.data("daterangepicker").setEndDate(d)):(a.data("daterangepicker").setStartDate(s),a.data("daterangepicker").setEndDate(s))),f())},h=function(){s=$(i).val(),e.utils.isEmpty(s)?(t.disable(),a.val("").trigger("change")):(u.minDate=s,a.daterangepicker(u),a.on("apply.daterangepicker",function(){f()}),t.enable(),e.utils.isEmpty(a.val())&&(a.data("daterangepicker").setStartDate(s),a.data("daterangepicker").setEndDate(s)),f(),o!==!1&&v())};i!==!1&&$(i).on("change",function(){h()}),o!==!1&&$(o).on("change",function(){v()}),o!==!1&&v(),i!==!1&&h()}var a,i=!1,o=!1,s=!1,d=!1;r()},e}(hex),hex=function(e){"use strict";return e.widgets.mask=function(e,t){function n(){if(r=e.getInputs()[0],void 0===t.mask)throw new Error(r.attr("name")+" doesn`t set mask param");a=t.mask,r.inputmask(a)}var r,a;n()},e}(hex),hex=function(e){"use strict";return e.widgets.phone=function(e,t){function n(){r=e.getInputs()[0],void 0!==t.mask&&(a=t.mask),r.inputmask(a)}var r,a="+7(999)999-99-99";n()},e}(hex),hex=function(e){"use strict";return e.widgets.select2=function(t,n){function r(){a=t.getInputs()[0];var r=n.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:r};if(void 0!==n.url){i="ajax";var s=a.find("option[selected]");if(n.ajax={url:n.url,method:"POST",dataType:"json",delay:250,data:function(e){return{search:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.rows,pagination:{more:t.page*e.limit<e.total}}},cache:!1},delete n.url,void 0!==n.parent){var d=n.parent.selector,l=n.parent.param||"parent_id";e.utils.isEmpty($(d).val())&&(t.disable(),a.val("").trigger("change")),$(d).on("change",function(){e.utils.isEmpty($(this).val())?(t.disable(),a.val("").trigger("change")):t.enable()}),delete n.parent;var u=function(){return $(d).val()};n.ajax.data=function(e){var t={search:e.term,page:e.page};return t[l]=u,t}}}$.extend(o,n),a.select2(o),"ajax"===i&&(s.each(function(){a.append($(this))}),a.trigger("change"))}var a,i="local";r()},e}(hex),hex=function(e){"use strict";return e.widgets.filesimple=function(e){function t(){function t(t){r=t.target.files[0],e.setValue(r)}n=e.getInputs()[0],n.bind("change",t)}var n,r;t()},e}(hex),hex=function(e){"use strict";return e.widgets.fileupload=function(t,n){function r(){var e=[];for(var n in C)C[n].valid&&void 0!==C[n].id&&e.push(parseInt(C[n].id));t.setValue(e),h.trigger("change")}function a(){var e=!1;for(var t in C)if(C[t].loading===!0){e=!0;break}E.loading=e}function i(e,t){var n=y.clone();void 0!==t&&n.addClass(t),n.find("i").attr("title",e.name).html(e.name);var r=n.find(".upload-preview");return void 0!==e.url?(r.attr("href",e.url),void 0!==e.thumb&&r.html('<img src="'+e.thumb+'"/>')):r.hide(),n.get(0).outerHTML}function o(){var e="";for(var t in C)e+=i(C[t]);g.html(e),g.find("thumb").each(function(e){C[e].setElement($(this))})}function s(e){if(w){for(var t in C)C[t].remove(!0);g.find("thumb").remove(),r()}var n=new B({uid:e.uniqueIdentifier,name:e.name,loading:!0}),o=i(n,"upfile-new loading");g.append(o),n.setElement(g.find("thumb:last-child")),C.push(n),n.progress(5),a()}function d(e){for(var t=C.length,n=0;t>=n;n++)if(C[n].uid===e)return C[n];return!1}function l(e,t){var n=d(e.uniqueIdentifier);n!==!1&&n.error(t),a()}function u(e,t){var n=d(e.uniqueIdentifier);n!==!1&&n.complete(t),a()}function c(e){var t=Math.floor(e.size/100),n=Math.floor(e.sizeUploaded()/t),r=d(e.uniqueIdentifier);r!==!1&&r.progress(n)}function f(){var e=[];g.find("thumb").each(function(){var t=$(this).attr("id");for(var n in C)C[n].rid===t&&e.push(C[n])}),C=e,r()}function v(){if(h=t.getInputs()[0],b="u_"+h.attr("id")+"_",void 0!==n.types){x=[];var a=/$[\.]/;for(var i in n.types){var d=n.types[i];a.test(d)||(d="."+d),x.push(d)}}if(n.single===!0&&(w=!0),void 0!==n.limit&&(k=parseInt(n.limit),isNaN(k)&&(k=1),0===k&&(k=0),delete n.limit),void 0===n.url)throw new Error("doesnt set url paremetr on "+t.name);p=n.url;var v={target:p,singleFile:w,simultaneousUploads:5,chunkSize:262144,maxChunkRetries:void 0,allowDuplicateUploads:!1,prioritizeFirstAndLastChunk:!0,generateUniqueIdentifier:function(t){var n="file_";return n+=t.size,n+=t.name,n+=b,n=e.utils.md5(n)}};if(m=new Flow(v),y=h.closest(".form-group").find(".upload-dropzone *").first().clone(!1),h.closest(".form-group").find(".upload-dropzone *").remove(),g=h.closest(".form-group").find(".upload-dropzone"),g.on("dragenter",function(){$(this).addClass("drag")}),g.on("dragover",function(){$(this).addClass("drag")}),g.on("dragend",function(){$(this).removeClass("drag")}),g.on("drop",function(){$(this).removeClass("drag")}),g.on("mouseout",function(){$(this).removeClass("drag")}),g.on("dragleave",function(){$(this).removeClass("drag")}),1!==k){var E=dragula([g[0]],{mirrorContainer:g.closest(".form-group")[0],direction:"horizontal",copy:!1,copySortSource:!1});E.on("drop",function(){f()})}var V=h.data("hexFiles");if(void 0!==V){for(var D in V){var I=new B(V[D]);C.push(I)}o()}if(r(),m.support){var S={};void 0!==x&&(S.accept=x.join(",")),m.assignBrowse(h.closest(".form-group").find("[data-upload]")[0],!1,w,S),m.assignDrop(g[0]),m.on("fileAdded",function(e){var t=!0;return void 0!==x&&x.indexOf("."+e.getType())<0&&(t=!1),t?s(e):(s(e),l(e,'"'+e.name+'" - неверный тип файла. Разрешены файлы типа: '+x.join(", "))),t}),m.on("fileSuccess",function(e,t){t=$.parseJSON(t),u(e,t)}),m.on("fileError",function(e,t){l(e,t)}),m.on("filesSubmitted",function(){m.upload()}),m.on("fileProgress",function(e){c(e)})}}var h,p,m,g,x,y,b,k=0,w=!1,C=[],E=this;E.loading=!1;var B=function(e){function t(){var e=b;void 0!==i.id&&(e+="_"+i.id),void 0!==i.uid&&(e+="_"+i.uid),i.rid=e,o.attr("id",e)}function n(e){if(void 0!==e)for(var t in e)i.hasOwnProperty(t)&&(i[t]=e[t]);void 0===i.id&&(i.valid=!1)}var i=this;i.id=void 0,i.uid=void 0,i.thumb=void 0,i.url=void 0,i.name=void 0,i.valid=!0,i.rid=0,i.loading=!1;var o;i.setElement=function(e){o=e,o.on("click","remove",function(e){return e.preventDefault(),i.remove(),!1}),t()},i.progress=function(e){i.valid=!1,o.find("p").show().css("width",e+"%")},i.complete=function(e){i.valid=!0,i.loading=!1,n(e),o.removeClass("loading");var t=o.find(".upload-preview");t.attr("href",i.url),t.show(),void 0!==i.thumb&&t.html('<img src="'+i.thumb+'"/>'),o.find("p").hide(),i.loading=!1,r()},i.remove=function(e){i.valid=!1,i.loading=!1;var t=C.indexOf(i);t>=0&&(E.uploaderRemoveFile(i.uid),C.splice(t,1)),e===!0?o.remove():o.fadeOut(function(){o.remove()}),a(),r()},i.error=function(e){i.valid=!1,i.loading=!1,o.find("p").hide(),o.removeClass("loading"),e="! Ошибка:<br/>"+e,o.find(".frame").html('<div class="upload-error">'+e+"</div>"),o.addClass("upfile-error"),o.removeClass("upfile-new");var t=C.indexOf(i);t>=0&&(E.uploaderRemoveFile(i.uid),C.splice(t,1))},n(e)};E.uploaderRemoveFile=function(e){var t=m.files;for(var n in t)if(t[n].uniqueIdentifier===e){m.removeFile(t[n]);break}},v()},e}(hex),hex=function(e){"use strict";return e.validators.required=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events)}var a=this,i=["blur","change","keyup"];a.weight=0;var o="required";a.getClassName=function(){return o},a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(t){return!e.utils.isEmpty(t)},r()},e}(hex),hex=function(e){"use strict";return e.validators.email=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events)}var a=this,i="email";a.getClassName=function(){return i};var o=["change","keyup"],s=/^\S+[@]\S+\.\S{2,10}$/i;a.weight=1,a.setEvents=function(e){o=e},a.getEvents=function(){return o},a.isValid=function(t){return e.utils.isEmpty(t)?!0:s.test(t)},r()},e}(hex),hex=function(e){"use strict";return e.validators.unique=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events),void 0!==t.url&&(i=t.url)}var r=this,a="unique";r.getClassName=function(){return a};var i,o=!1,s=!1,d=["change","keyup","blur"];r.weight=5,r.setEvents=function(e){d=e},r.getEvents=function(){return d},r.isValid=function(e){if(s!==!1&&s.abort(),o!==e){s=$.ajax({url:i,data:{value:e},method:"POST",async:!1});var t=s.responseText;return o="true"===t?e:!1,t}return!0},n()},e}(hex),hex=function(e){"use strict";return e.validators.stringLength=function(e,t){function n(){void 0!==t.min&&(r=t.min),void 0!==t.max&&(a=t.max),void 0!==t.events&&i.setEvents(t.events)}var r,a,i=this,o="string-length";i.getClassName=function(){return o};var s=["change","keyup","blur"];i.weight=3,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(e){var t=e.length;return void 0!==r&&r>t?(o="string-length-min",!1):void 0!==a&&t>a?(o="string-length-max",!1):!0},n()},e}(hex),hex=function(e){"use strict";return e.validators.passwordConfirm=e.validators.confirm=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events),void 0!==t.password&&(o=$(t.password))}var r=this,a="password-confirm";r.getClassName=function(){return a};var i=["change","keyup","blur"];r.weight=4;var o;r.setEvents=function(e){i=e},r.getEvents=function(){return i},r.isValid=function(e){return o.val()===e},n()},e}(hex),hex=function(e){"use strict";return e.validators.mask=function(t,n){function r(){void 0!==n.events&&i.setEvents(n.events),a=t.getInputs()[0]}var a,i=this,o="mask",s=["blur"];i.getClassName=function(){return o},i.weight=4,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.phone=function(t,n){function r(){void 0!==n.events&&i.setEvents(n.events),a=t.getInputs()[0]}var a,i=this,o="phone",s=["blur"];i.getClassName=function(){return o},i.weight=4,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.date=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events),o=t.getInputs()[0]}var a=this,i=["change","keyup","blur"];a.weight=3;var o,s="date";a.getClassName=function(){return s},a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=o.inputmask("option","mask");return Inputmask.isValid(o.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.fileupload=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events)}var r=this,a="fileupload";r.getClassName=function(){return a};var i=[];r.setEvents=function(e){i=e},r.getEvents=function(){return i},r.isValid=function(){var t=e.getWidgets().fileupload;return void 0===t?!0:t.loading!==!0},n()},e}(hex),hex=function(e){"use strict";function t(t){function n(e){function t(){r.isValid(!1);var t=s.getValue(),n=!1;null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?n=!1:("string"==typeof t&&t===o&&(n=!0),"object"==typeof t&&t.indexOf(o)>=0&&(n=!0)),n?(e.show(),e.find('input[type!="submit"],select,textarea').trigger("enable")):(e.hide(),e.find('input[type!="submit"],select,textarea').trigger("disable"))}if(e.parents('[data-hex-multy-item="$"]').size()>0)return!1;var n=e.closest("[data-hex-block]").attr("id"),r=i.mainBlock.findBlockById(n),a=e.data("hexDisabled"),o=a.value,s=i.findControlByName(a.control);if(void 0===s)throw new Error('Control "'+a.control+'" not found');s.addEvent("change",t),s.trigger("change")}function r(e){return e.replace("-","").toUpperCase()}function a(e){function t(e,t){i.hexBind(e,{"@index":t})}function r(){if(d===!1){var t=e.find("[data-hex-multy-item]");t.size()<=1?e.find("[data-hex-multy-remove]").attr("disabled","disabled"):e.find("[data-hex-multy-remove]").removeAttr("disabled")}}var a,o,s=e.data("hex-multy"),d=!1;void 0!==s.allow_empty&&s.allow_empty===!0&&(d=!0),e.find("[data-hex-multy-tabs]").size()>0&&(a=e.find("[data-hex-multy-tabs]"),o=a.find('[data-hex-multy-tab="$"]').clone(!1),a.find('[data-hex-multy-tab="$"]').remove());var l=e.find('[data-hex-multy-item="$"]'),u=l.clone(!1);l.remove(),e.on("click","[data-hex-multy-add]",function(){var s=e.find("[data-hex-multy-item]"),d=s.size(),l=u.clone(!1);l.find("[data-hex-multy-hide]").remove(),l.find("[data-hex-multy-attr]").each(function(){var e=$(this),t=e.data("hex-multy-attr");if(void 0!==t.add&&$.each(t.add,function(t,n){for(var r in n)e.attr(r,n[r])}),void 0!==t.remove)for(var n in t.remove)e.removeAttr(t.remove[n])});var c=e.find("[data-hex-multy-items]").closest("[data-hex-block]").attr("id"),f=i.mainBlock.findBlockById(c);if(void 0!==a){var v=o.clone(!1);e.find("[data-hex-multy-tab]:last").size()>0?v.insertAfter(e.find("[data-hex-multy-tab]:last")):a.prepend(v),t(v,d)}t(l,d),l.appendTo(e.find("[data-hex-multy-items]")),f.addBlock(l),void 0!==a&&$('a[href="#'+l.attr("id")+'"]').trigger("click"),l.find("[data-hex-disabled]").size()>0&&l.find("[data-hex-disabled]").each(function(){n($(this))}),r()}),e.on("click","[data-hex-multy-remove]",function(){var n=$(this).closest("[data-hex-multy-item]"),o=n.data("hexMultyItem");n.fadeOut(500,function(){i.removeBlock(n.attr("id"));var s=e.find("[data-hex-multy-item]");s.each(function(){$(this).data("hexMultyItem")>o&&t($(this),$(this).data("hexMultyItem")-1)}),void 0!==a&&(a.find('[data-hex-multy-tab="'+o+'"]').remove(),a.find("[data-hex-multy-tab]").each(function(){$(this).data("hexMultyTab")>o&&t($(this),$(this).data("hexMultyTab")-1)}),a.find("[data-hex-multy-tab="+o+"]").size()>0?a.find("[data-hex-multy-tab="+o+"]").find('a[role="tab"]').trigger("click"):a.find("[data-hex-multy-tab]:nth-child("+o+")").size()>0&&a.find("[data-hex-multy-tab]:nth-child("+o+")").find('a[role="tab"]').trigger("click")),r(),console.log(i)})}),r()}var i=this;i.controls=[],i.errorText="Не удалось сохранить форму, попробуйте обновить страницу",i.invalidText="Форма содержит ошибки";var o=$("#"+t),s={};i.mainBlock=void 0;var d=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};i.removeBlock=function(e){var t=i.mainBlock.findBlockById(e);if(t===!1)return!1;for(var n in t.controls){var r=t.controls[n],a=i.findControlByName(r.name);a!==!1&&i.controls.splice(i.controls.indexOf(a),1)}if(t.controls=[],t.element.remove(),void 0!==t.parent)for(var o in t.parent.childBlocks)t.parent.childBlocks[o]===t&&t.parent.childBlocks.splice(o,1);i.mainBlock.isValid(!1)},i.findControlByName=function(e){for(var t in i.controls)if(i.controls[t].name===e)return i.controls[t];return!1},i.on=function(e,t){void 0===s[e]&&(s[e]=[]),s[e].indexOf(t)<0&&s[e].push(t)},i.off=function(e,t){void 0!==s[e]&&s[e].splice(s[e].indexOf(t),1)},i.fire=function(e,t){if(void 0!==s[e]){var n=new d(e);for(var r in s[e]){var a=s[e][r];a(t,n)}return!n.stoped}return!0},i.getHandlers=function(){return s};var l=function(){var e={};for(var t in i.controls)if(i.controls.hasOwnProperty(t)&&i.controls[t].disabled===!1){var n=i.controls[t].name,r=i.controls[t].getValue();null===r||$.isArray(r)&&0===r.length?r="":e[n]=r}return e},u=function(e){var t=i.fire("beforeReset",{values:i.getValues()});t?window.setTimeout(function(){for(var e in i.controls)i.controls.hasOwnProperty(e)&&i.controls[e].reset();o.find(".has-error").removeClass("has-error"),o.find(".alerts .alert").remove()},1):e.preventDefault(),i.fire("afterReset",{})},c=function(){o.find(".has-error").removeClass("has-error"),o.find(".alerts div").remove()},f=function(e){e.preventDefault(),e.stopPropagation();var t=i.mainBlock.isValid();if(t===!0){c();var n=l(),r=i.fire("beforeSubmit",{values:n});if(r){i.loaderShow();var a=o.attr("action"),s=o.find("button[type=submit]:focus");s.size()>0&&void 0!==s.attr("data-action")&&(a=s.attr("data-action"));var d="POST";void 0!==o.attr("method")&&(d=o.attr("method"));var u=new FormData;$.each(n,function(e,t){if($.isArray(t)||$.isPlainObject(t))for(var n in t)null!==t[n]&&t[n]!==!1&&void 0!==t[n]&&u.append(e,t[n]);else u.append(e,t)}),$.ajax({url:a,data:u,type:d,dataType:"json",processData:!1,contentType:!1,success:function(e){var t=i.fire("afterSubmit",e);t&&window.setTimeout(function(){if(e.success===!0?(c(),void 0!==e.reload?e.reload===!0?window.location.href=window.location.href:window.location.href=e.reload:i.loaderHide()):i.loaderHide(),void 0!==e.alerts){for(var t in e.alerts){var n=e.alerts[t];o.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}i.loaderHide()}},1)},error:function(){i.loaderHide(),o.find(".alerts").append($("<div>").addClass("alert alert-danger").html(i.errorText))}})}}else o.find(".alerts div").remove(),o.find(".alerts").append($("<div>").addClass("alert alert-danger").html(i.invalidText));return!1};i.loaderShow=function(){o.find(".loader").show()},i.loaderHide=function(){o.find(".loader").hide()},i.submit=function(){f()},i.getValues=function(){return l()},i.hexBind=function(e,t){function n(e){var t=e.split(""),n=[],r=[],a=0,i=!0;n[a]="";for(var o=0;o<t.length;o++)isNaN(parseInt(t[o]))&&"."!==t[o]&&!i?(r[a]=t[o],a++,n[a]="",i=!0):(n[a]+=t[o],i=!1);e=parseFloat(n[0]);for(var s=0;s<r.length;s++){var d=parseFloat(n[s+1]);switch(r[s]){case"+":e+=d;break;case"-":e-=d;break;case"*":e*=d;break;case"/":e/=d}}return e}function a(e){if("object"==typeof e)for(var r in e)e[r]=a(e[r]);else{for(var i in t)e=e.replace(new RegExp(i,"g"),t[i]);/\%/.test(e)&&(e=e.replace(/\%(.*?)\%/g,function(e){return n(e.replace(/\%/g,""))}))}return e}var o=[];o.push(e),e.find("[data-hex-bind]").each(function(){o.push($(this))});for(var s in o){var d=o[s].data("hexBind");for(var l in d){var u=a(d[l]);if("html"!==l){if(/^data/.test(l)){var c=l.replace(/^data-/,"");c=c.replace(/(\-[a-z])/g,r),o[s].data(c,u)}if("name"===l){var f=o[s].attr("name"),v=i.findControlByName(f);v!==!1&&(v.name=u)}if("id"===l&&0>=s){console.log("-----------change block.id start-------------");var h=i.mainBlock.findBlockById(o[s].attr("id"));console.log(u),h!==!1?h.id=u:console.log("block not found id:"+o[s].attr("id")),console.log(h),console.log("=========change block.id=========")}"object"==typeof u?o[s].attr(l,JSON.stringify(u)):o[s].attr(l,u)}else o[s].html(u)}}};var v=function(){o.addClass("loader-container").append('<div class="loader"></div>'),o.attr("data-hex-block",""),$(document).on("submit","#"+t,f),$(document).on("reset","#"+t,u),0===o.find(".loader").size()&&o.append('<div class="loader"></div>'),i.mainBlock=new e.Block(o,i),o.find("[data-hex-multy]").size()>0&&o.find("[data-hex-multy]").each(function(){a($(this))}),o.find("[data-hex-disabled]").size()>0&&o.find("[data-hex-disabled]").each(function(){n($(this))})};return v(),i}var n={};return e.form=function(e){if(void 0!==e)return void 0===n[e]&&(n[e]=new t(e)),n[e];var r=$("form.hex-form");return r.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");void 0===n[e]&&(n[e]=new t(e))}),n},$(document).ready(function(){e.form()}),e}(hex);