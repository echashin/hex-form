var HexWidget=function(e,t){"use strict";function n(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!0:!1}function a(e){function t(e){void 0!==e.input&&(a=e.input,n=a.closest(".form-group").find("button.password-show"),n.bind("click",function(e){return e.preventDefault(),"password"===r?(a.attr("type","text"),n.addClass("active"),r="text"):(a.attr("type","password"),n.removeClass("active"),r="password"),a.focus(),!1}))}var n,a,r="password";t(e)}function r(e){function t(e){return s=e.length>8?1:0,u=e.match(v)?1:0,d=e.match(f)?1:0,l=e.match(p)?1:0,c=e.match(h)?1:0,s+u+d+l+c}function n(e){void 0!==e.events&&i.setEvents(e.events),void 0!==e.input&&(a=e.input,r=a.closest(".form-group").find(".password-strength div"),a.bind("keyup change",function(){var e=a.val();r.attr("class","s-"+t(e))}))}var a,r,i=this,o=["change"],s=0,u=0,d=0,l=0,c=0,v=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),p=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,i.setEvents=function(e){o=e},i.getEvents=function(){return o},n(e)}function i(e){function t(e){if(void 0!==e.input){n=e.input;var t=moment.localeData(),a={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:t.longDateFormat("L"),separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:t.firstDayOfWeek()}};$.extend(a,e);var r=a.locale.format.replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");a.singleDatePicker===!1&&(r+=a.locale.separator+r),n.inputmask(r),n.daterangepicker(a,function(e,t){var r=e.format(a.locale.format);a.singleDatePicker===!1&&(r+=a.locale.separator+t.format(a.locale.format)),n.val(r),n.trigger("blur")})}}var n;t(e)}function o(e){function t(e){if(void 0!==e.control&&(r=e.control),void 0!==e.input){a=e.input;var t=e.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:t};if(void 0!==e.url){i="ajax";var s=a.find("option[selected]");if(e.ajax={url:e.url,method:"POST",dataType:"json",delay:250,data:function(e){return{search:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.rows,pagination:{more:t.page*e.limit<e.total}}},cache:!1},delete e.url,void 0!==e.parent){var u=e.parent.selector,d=e.parent.param||"parent_id";n($(u).val())&&(r.disable(),a.val("").trigger("change")),$(u).on("change",function(){n($(this).val())?(r.disable(),a.val("").trigger("change")):r.enable()}),delete e.parent;var l=function(){return $(u).val()};e.ajax.data=function(e){var t={search:e.term,page:e.page};return t[d]=l,t}}}$.extend(o,e),a.select2(o),"ajax"===i&&(s.each(function(){a.append($(this))}),a.trigger("change"))}}var a,r,i="local";t(e)}function s(e){function t(e){function t(e){r=e.target.files[0],a.setValue(r)}n=e.input,a=e.control,n.bind("change",t)}var n,a,r;t(e)}function u(e){function t(e){n=e.input,n.inputmask(e.mask)}var n;t(e)}function d(e){function t(e){void 0!==e.input&&(n=e.input,n.inputmask("+7(999)999-99-99"))}var n;t(e)}function l(e){function t(e){switch(e.type){case"password-strength":return new r(e);case"password-show":return new a(e);case"date":return new i(e);case"phone":return new d(e);case"select2":return new o(e);case"mask":return new u(e);case"filesimple":return new s(e);default:throw new Error("Unfinded widget: "+e.type)}}return t(e)}return l}(window,document),HexValidator=function(){"use strict";function e(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,a=["blur","change"];n.weight=0;var r="required";n.getClassName=function(){return r},n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){return null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length?!1:!0},t(e)}function t(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.input&&(r=e.input)}var n=this,a=["change","keyup","blur"];n.weight=3;var r,i="date";n.getClassName=function(){return i},n.setEvents=function(e){a=e},n.getEvents=function(){return a},n.isValid=function(e){if(""===e||void 0===e||e===!1)return!0;var t=r.inputmask("option","mask");return Inputmask.isValid(r.val(),{alias:t})},t(e)}function n(e){function t(e){void 0!==e.events&&n.setEvents(e.events)}var n=this,a="email";n.getClassName=function(){return a};var r=["change","keyup"],i=/^\S+[@]\S+\.\S{2,10}$/i;n.weight=1,n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){return""===e||void 0===e||e===!1?!0:i.test(e)},t(e)}function a(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.url&&(r=e.url)}var n=this,a="unique";n.getClassName=function(){return a};var r,i=!1,o=!1,s=["change","keyup","blur"];n.weight=5,n.setEvents=function(e){s=e},n.getEvents=function(){return s},n.isValid=function(e){if(o!==!1&&o.abort(),i!==e){o=$.ajax({url:r,data:{value:e},method:"POST",async:!1});var t=o.responseText;return i="true"===t?e:!1,t}return!0},t(e)}function r(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.input&&(n=e.input)}var n,a=this,r="phone",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(e){if(""===e||void 0===e||e===!1||null===e)return!0;var t=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:t})},t(e)}function i(e){function t(e){void 0!==e.events&&a.setEvents(e.events),void 0!==e.input&&(n=e.input)}var n,a=this,r="mask",i=["blur"];a.getClassName=function(){return r},a.weight=4,a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(e){if(""===e||void 0===e||e===!1||null===e)return!0;var t=n.inputmask("option","mask");return Inputmask.isValid(n.val(),{alias:t})},t(e)}function o(e){function t(e){void 0!==e.min&&(n=e.min),void 0!==e.max&&(a=e.max),void 0!==e.events&&r.setEvents(e.events)}var n,a,r=this,i="string-length";r.getClassName=function(){return i};var o=["change","keyup","blur"];r.weight=3,r.setEvents=function(e){o=e},r.getEvents=function(){return o},r.isValid=function(e){var t=e.length;return void 0!==n&&n>t?(i="string-length-min",!1):void 0!==a&&t>a?(i="string-length-max",!1):!0},t(e)}function s(e){function t(e){void 0!==e.events&&n.setEvents(e.events),void 0!==e.password&&(i=$(e.password))}var n=this,a="password-confirm";n.getClassName=function(){return a};var r=["change","keyup","blur"];n.weight=4;var i;n.setEvents=function(e){r=e},n.getEvents=function(){return r},n.isValid=function(e){return i.val()===e},t(e)}function u(u){function d(u){switch(u.type){case"required":return new e(u);case"email":return new n(u);case"unique":return new a(u);case"password-confirm":return new s(u);case"string-length":return new o(u);case"date":return new t(u);case"phone":return new r(u);case"mask":return new i(u);default:throw new Error("Unfinded validator: "+u.type)}}return d(u)}return u}(),hexForm=function(e,t){"use strict";function n(e){function t(e){return function(t,n){return"number"==typeof t[e]?t[e]-n[e]:t[e]<n[e]?-1:t[e]>n[e]?1:0}}var n=this;n.type=void 0,n.valid=!0,n.name=void 0;var a,r,i,o,s=[],u=e.form;n.tabPanelId=void 0;var d,l=[],c={},v={};n.disabled=!1,n.readonly=!1,n.setValid=function(){i.removeClass("has-error"),r.find("span").removeClass("active")},n.enable=function(){for(var e in s)s[e].prop("disabled",!1);n.disabled=!1},n.disable=function(){for(var e in s)s[e].prop("disabled",!0);n.disabled=!0},n.addReadonly=function(){for(var e in s)s[e].prop("readonly",!0);n.readonly=!0},n.removeReadonly=function(){for(var e in s)s[e].prop("readonly",!1);n.readonly=!1};var f=function(){var e=0;if(r.find("span").removeClass("active"),!n.disabled)for(var t in l)if(l.hasOwnProperty(t)){var o=l[t],s=n.getValue(),d=o.isValid(s);if(d===!1||"false"===d){e++,r.find("span.error-"+o.getClassName()).addClass("active");break}}if(e>0?(n.valid=!1,i.addClass("has-error")):(i.removeClass("has-error"),n.valid=!0),void 0!==a){var c=!0;for(var v in u.controls)if(u.controls.hasOwnProperty(v)){var f=u.controls[v];if(f.tabPanelId===n.tabPanelId&&f.valid===!1){c=!1;break}}c===!0?a.removeClass("has-error"):a.addClass("has-error")}return n.valid};n.validate=function(e){return void 0===e?f():"blur"===e.type?f():(void 0!==o&&clearTimeout(o),void(o=setTimeout(f,500)))},n.trigger=function(e){for(var t=0;t<s.length;t++)s[t].trigger(e)};var p=function(e){for(var t={},n=e[0].attributes,a=n.length,r=0;a>r;r++)t[n[r].name.toLowerCase()]=n[r].value;return t},h=function(e,t,n){var a={input:n,type:e};void 0!==t&&""!==t&&$.extend(a,jQuery.parseJSON(t));var r=new HexValidator(a),i=r.getEvents();for(var o in i)i.hasOwnProperty(o)&&(v[i[o]]=!0);l.push(r)},m=function(e,t,a){var r={input:a,type:e,control:n};void 0!==t&&""!==t&&$.extend(r,jQuery.parseJSON(t)),c[e]=new HexWidget(r)};n.addInput=function(e){s.push(e);var a=p(e);for(var r in a)if(a.hasOwnProperty(r)){if("required"===r)h("required",a[r],e);else{var i=r.match(/^data-hex-validator-(.*)$/i);null!==i&&void 0!==i[1]&&h(i[1],a[r],e)}var o=r.match(/^data-hex-widget-(.*)$/i);null!==o&&void 0!==o[1]&&m(o[1],a[r],e)}for(var u in v)v.hasOwnProperty(u)&&e.bind(u,n.validate);l.sort(t("weight")),e.prop("disabled")&&n.disable(),e.prop("readonly")&&n.addReadonly(),e.bind("disable",function(){n.disable()}),e.bind("enable",function(){n.enable()})},n.getValue=function(){switch(n.type){case"text":default:if(void 0!==c.date){var e=s[0].data("daterangepicker");if(void 0===e)return s[0].val();if(""===s[0].val())return!1;var t="";if(t+=e.startDate.format("YYYY-MM-DD"),e.singleDatePicker===!1){var a=e.endDate.format("YYYY-MM-DD");t+=" - "+a}return t}return void 0!==c.fileupload||void 0!==c.filesimple?d:s[0].val();case"radio":for(var r in s)if(s.hasOwnProperty(r)&&s[r].is(":checked")===!0)return s[r].val();return!1;case"checkbox":return s[0].is(":checked")===!0?n.trueValue:n.falseValue}},n.setValue=function(e){d=e};var g=function(e){if(void 0!==e.type&&(n.type=e.type,"checkbox"===e.type&&(n.trueValue=!0,n.falseValue=!1)),void 0!==e.form&&(u=e.form),n.name=e.name,void 0!==e.inputs)for(var t in e.inputs)e.inputs.hasOwnProperty(t)&&n.addInput(e.inputs[t]);i=s[0].closest("div.form-group"),r=i.find(".errors");var o=i.closest(".tab-pane");if(o.size()>0){var d=o.attr("id"),l=$('.nav a[href="#'+d+'"]');l.size()>0&&(a=l),n.tabPanelId=d}n.setValid()};g(e)}function a(a){function r(e){function t(e,t){e.attr("data-hex-multy-item",t),e.find('input[type!="submit"],select,textarea').each(function(){var e=$(this).attr("name");e=e.replace(/\[\d+\]/g,function(){return"["+t+"]"}),$(this).attr("name",e)})}function n(){if(r===!1){var t=e.find("[data-hex-multy-item]");t.size()<=1?e.find("[data-hex-multy-remove]").attr("disabled","disabled"):e.find("[data-hex-multy-remove]").removeAttr("disabled")}}var a=e.data("hex-multy"),r=!1;void 0!==a.allow_empty&&a.allow_empty===!0&&(r=!0);var i=e.find('[data-hex-multy-item="$"]'),o=i.clone(!1);i.remove(),o.find('input[type!="submit"],select,textarea').each(function(){$(this).val("")}),e.on("click","[data-hex-multy-add]",function(){var a=$(this).closest("[data-hex-multy]").find("[data-hex-multy-item]"),r=a.size(),i=o.clone(!1);i.find("[data-hex-multy-hide]").remove(),i.find("[data-hex-multy-attr]").each(function(){var e=$(this),t=e.data("hex-multy-attr");if(void 0!==t.add&&$.each(t.add,function(t,n){for(var a in n)e.attr(a,n[a])}),void 0!==t.remove)for(var n in t.remove)e.removeAttr(t.remove[n])}),t(i,r),c(i),i.appendTo(e.find("[data-hex-multy-items]")),n()}),e.on("click","[data-hex-multy-remove]",function(){var a=$(this).closest("[data-hex-multy-item]"),r=parseInt(a.attr("data-hex-multy-item")),i=e.find("[data-hex-multy-item]");l(a),a.remove(),i.each(function(e,n){e>r&&t($(this),--e)}),n()}),n()}var i=this;i.controls={};var o=a,s=o.attr("id"),u={},d=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};i.on=function(e,t){void 0===u[e]&&(u[e]=[]),u[e].push(t)},i.off=function(e,t){void 0!==u[e]&&u[e].splice(u[e].indexOf(t),1)},i.fire=function(e,t){var n=new d(e);if(void 0!==u[e])for(var a in u[e]){var r=u[e][a];r(t,n)}return!n.stoped};var l=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,t){var n=$(t),a=n.attr("name");void 0!==i.controls[a]&&delete i.controls[a]})},c=function(e){$.each(e.find('input[type!="submit"],select,textarea'),function(e,t){var a=$(t),r=a.attr("name"),o=a.prop("tagName").toLowerCase();switch(o){case"select":case"textarea":i.controls[r]=new n({type:o,inputs:[a],form:i,name:r});break;case"input":var s=a.attr("type").toLowerCase();switch(s){default:i.controls[r]=new n({type:s,inputs:[a],form:i,name:r});break;case"checkbox":var u=new n({type:"checkbox",inputs:[a],form:i,name:r});void 0!==a.attr("value")&&(u.trueValue=a.attr("value")),void 0!==a.attr("data-hex-true-value")&&(u.trueValue=a.attr("data-hex-true-value")),void 0!==a.attr("data-hex-false-value")&&(u.falseValue=a.attr("data-hex-false-value")),i.controls[r]=u;break;case"radio":void 0===i.controls[r]?i.controls[r]=new n({type:"radio",inputs:[a],form:i,name:r}):i.controls[r].addInput(a)}}})},v=function(){var e={};for(var t in i.controls)if(i.controls.hasOwnProperty(t)&&i.controls[t].disabled===!1){var n=i.controls[t].name,a=i.controls[t].getValue();null===a||$.isArray(a)&&0===a.length?a="":e[n]=a}return e},f=function(t){var n=i.fire("beforeReset",{values:i.getValues()});n?e.setTimeout(function(){for(var e in i.controls)i.controls.hasOwnProperty(e)&&i.controls[e].trigger("change")},1):t.preventDefault(),i.fire("afterReset",{})},p=function(){o.find(".has-error").removeClass("has-error"),o.find(".alerts div").remove()},h=function(t){t.preventDefault(),t.stopPropagation();var n=!0;for(var a in i.controls)i.controls.hasOwnProperty(a)&&i.controls[a].validate(void 0)===!1&&(n=!1);if(n===!0){p();var r=v(),s=i.fire("beforeSubmit",{values:r});if(s){i.loaderShow();var u=o.attr("action"),d=o.find("button[type=submit]:focus");d.size()>0&&void 0!==d.attr("data-action")&&(u=d.attr("data-action"));var l="POST";void 0!==o.attr("method")&&(l=o.attr("method"));var c=new FormData;$.each(r,function(e,t){if($.isArray(t)||$.isPlainObject(t))for(var n in t)null!==t[n]&&t[n]!==!1&&void 0!==t[n]&&c.append(e,t[n]);else c.append(e,t)}),$.ajax({url:u,data:c,type:l,dataType:"json",processData:!1,contentType:!1,success:function(t){if(t.success===!0?(p(),void 0!==t.reload?t.reload===!0?e.location.href=e.location.href:e.location.href=t.reload:i.loaderHide()):i.loaderHide(),void 0!==t.alerts){for(var n in t.alerts){var a=t.alerts[n];o.find(".alerts").append($("<div>").addClass("alert alert-"+a.type).html(a.text))}i.loaderHide()}},error:function(e,t,n){i.loaderHide()}})}}return!1};i.loaderShow=function(){o.find(".loader").show()},i.loaderHide=function(){o.find(".loader").hide()},i.submit=function(){h()},i.getValues=function(){return v()};var m=function(){o.addClass("loader-container").append('<div class="loader"></div>'),$(t).on("submit","#"+s,h),$(t).on("reset","#"+s,f),0===o.find(".loader").size()&&o.append('<div class="loader"></div>'),c(o),o.find("div[data-hex-multy]").size()>0&&o.find("div[data-hex-multy]").each(function(){r($(this))})};return m(),i}function r(e){if(void 0!==e)return void 0===i[e]&&(i[e]=new a($("#"+e))),i[e];var t=$("form.hex-form");return t.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");i[e]=new a($(this))}),i}var i={};return r}(window,document);