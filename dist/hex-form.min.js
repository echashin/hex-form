var hex=function(){"use strict";var e={widgets:{},validators:{},utils:{}};return e.utils.toCamel=function(e){return e.replace(/[-_]([a-z])/g,function(e){return e[1].toUpperCase()})},e.utils.isEmpty=function(e){return!!(null===e||e===!1||void 0===e||""===e||$.isArray(e)&&0===e.length)},e.utils.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,a,i,o;return a=2147483648&e,i=2147483648&t,n=1073741824&e,r=1073741824&t,o=(1073741823&e)+(1073741823&t),n&r?2147483648^o^a^i:n|r?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function r(e,t,n){return e&t|~e&n}function a(e,t,n){return e&n|t&~n}function i(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function s(e,a,i,o,s,d,u){return e=n(e,n(n(r(a,i,o),s),u)),n(t(e,d),a)}function d(e,r,i,o,s,d,u){return e=n(e,n(n(a(r,i,o),s),u)),n(t(e,d),r)}function u(e,r,a,o,s,d,u){return e=n(e,n(n(i(r,a,o),s),u)),n(t(e,d),r)}function l(e,r,a,i,s,d,u){return e=n(e,n(n(o(r,a,i),s),u)),n(t(e,d),r)}function c(e){for(var t,n=e.length,r=n+8,a=(r-r%64)/64,i=16*(a+1),o=Array(i-1),s=0,d=0;n>d;)t=(d-d%4)/4,s=d%4*8,o[t]=o[t]|e.charCodeAt(d)<<s,d++;return t=(d-d%4)/4,s=d%4*8,o[t]=o[t]|128<<s,o[i-2]=n<<3,o[i-1]=n>>>29,o}function f(e){var t,n,r="",a="";for(n=0;3>=n;n++)t=e>>>8*n&255,a="0"+t.toString(16),r+=a.substr(a.length-2,2);return r}function v(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var h,p,m,g,x,y,b,k,w,$=[],C=7,E=12,B=17,V=22,D=5,I=9,S=14,O=20,z=4,N=11,P=16,M=23,T=6,j=10,R=15,L=21;for(e=v(e),$=c(e),y=1732584193,b=4023233417,k=2562383102,w=271733878,h=0;h<$.length;h+=16)p=y,m=b,g=k,x=w,y=s(y,b,k,w,$[h+0],C,3614090360),w=s(w,y,b,k,$[h+1],E,3905402710),k=s(k,w,y,b,$[h+2],B,606105819),b=s(b,k,w,y,$[h+3],V,3250441966),y=s(y,b,k,w,$[h+4],C,4118548399),w=s(w,y,b,k,$[h+5],E,1200080426),k=s(k,w,y,b,$[h+6],B,2821735955),b=s(b,k,w,y,$[h+7],V,4249261313),y=s(y,b,k,w,$[h+8],C,1770035416),w=s(w,y,b,k,$[h+9],E,2336552879),k=s(k,w,y,b,$[h+10],B,4294925233),b=s(b,k,w,y,$[h+11],V,2304563134),y=s(y,b,k,w,$[h+12],C,1804603682),w=s(w,y,b,k,$[h+13],E,4254626195),k=s(k,w,y,b,$[h+14],B,2792965006),b=s(b,k,w,y,$[h+15],V,1236535329),y=d(y,b,k,w,$[h+1],D,4129170786),w=d(w,y,b,k,$[h+6],I,3225465664),k=d(k,w,y,b,$[h+11],S,643717713),b=d(b,k,w,y,$[h+0],O,3921069994),y=d(y,b,k,w,$[h+5],D,3593408605),w=d(w,y,b,k,$[h+10],I,38016083),k=d(k,w,y,b,$[h+15],S,3634488961),b=d(b,k,w,y,$[h+4],O,3889429448),y=d(y,b,k,w,$[h+9],D,568446438),w=d(w,y,b,k,$[h+14],I,3275163606),k=d(k,w,y,b,$[h+3],S,4107603335),b=d(b,k,w,y,$[h+8],O,1163531501),y=d(y,b,k,w,$[h+13],D,2850285829),w=d(w,y,b,k,$[h+2],I,4243563512),k=d(k,w,y,b,$[h+7],S,1735328473),b=d(b,k,w,y,$[h+12],O,2368359562),y=u(y,b,k,w,$[h+5],z,4294588738),w=u(w,y,b,k,$[h+8],N,2272392833),k=u(k,w,y,b,$[h+11],P,1839030562),b=u(b,k,w,y,$[h+14],M,4259657740),y=u(y,b,k,w,$[h+1],z,2763975236),w=u(w,y,b,k,$[h+4],N,1272893353),k=u(k,w,y,b,$[h+7],P,4139469664),b=u(b,k,w,y,$[h+10],M,3200236656),y=u(y,b,k,w,$[h+13],z,681279174),w=u(w,y,b,k,$[h+0],N,3936430074),k=u(k,w,y,b,$[h+3],P,3572445317),b=u(b,k,w,y,$[h+6],M,76029189),y=u(y,b,k,w,$[h+9],z,3654602809),w=u(w,y,b,k,$[h+12],N,3873151461),k=u(k,w,y,b,$[h+15],P,530742520),b=u(b,k,w,y,$[h+2],M,3299628645),y=l(y,b,k,w,$[h+0],T,4096336452),w=l(w,y,b,k,$[h+7],j,1126891415),k=l(k,w,y,b,$[h+14],R,2878612391),b=l(b,k,w,y,$[h+5],L,4237533241),y=l(y,b,k,w,$[h+12],T,1700485571),w=l(w,y,b,k,$[h+3],j,2399980690),k=l(k,w,y,b,$[h+10],R,4293915773),b=l(b,k,w,y,$[h+1],L,2240044497),y=l(y,b,k,w,$[h+8],T,1873313359),w=l(w,y,b,k,$[h+15],j,4264355552),k=l(k,w,y,b,$[h+6],R,2734768916),b=l(b,k,w,y,$[h+13],L,1309151649),y=l(y,b,k,w,$[h+4],T,4149444226),w=l(w,y,b,k,$[h+11],j,3174756917),k=l(k,w,y,b,$[h+2],R,718787259),b=l(b,k,w,y,$[h+9],L,3951481745),y=n(y,p),b=n(b,m),k=n(k,g),w=n(w,x);var F=f(y)+f(b)+f(k)+f(w);return F.toLowerCase()},e}(),hex=function(e){"use strict";return console.log(window),e.Block=function(t,n,r){function a(){var e=[],n={};t.find('input[type!="submit"],select,textarea').each(function(){var t=$(this),n=t.parents('[data-hex-block][data-hex-multy-item!="$"]:first').attr("id");n===o.id&&e.push(t)}),t.find('[data-hex-block][data-hex-multy-item!="$"]').each(function(){var e=$(this);e.parents('[data-hex-block][data-hex-multy-item!="$"]:first').attr("id")===o.id&&(n[e.attr("id")]=e)});for(var r in n)o.addBlock(n[r]);d(e)}function i(){if(o.id=t.attr("id"),o.form=n,o.element=t,o.parent=r,$('[href="#'+o.id+'"]').size()>0&&(s=$('[href="#'+o.id+'"]')),void 0===o.id)throw console.log(t),new Error("[data-hex-block] must have id attr");a()}var o=this;o.element=void 0,o.childBlocks=[],o.controls=[],o.parent=void 0;var s;o.id=void 0,o.valid=!0,o.form=void 0,o.hideErrors=function(){void 0!==s&&s.removeClass("has-error")},o.findBlockById=function(e){if(o.id===e)return o;for(var t in o.childBlocks){var n=o.childBlocks[t].findBlockById(e);if(n!==!1)return n}return!1},o.addBlock=function(t){o.childBlocks.push(new e.Block(t,n,o))},o.showErrors=function(){void 0!==s&&s.addClass("has-error")},o.isValid=function(e){var t=!0;for(var n in o.controls)o.controls[n].isValid(e)||(t=!1);for(var r in o.childBlocks)o.childBlocks[r].isValid(e)||(t=!1);return o.valid=t,void 0!==s&&(t?s.removeClass("has-error"):o.showErrors()),o.valid},o.setValid=function(){},o.getValues=function(){};var d=function(e){var t={};for(var n in e){var r=e[n];if(r.parents('[data-hex-multy-item="$"]').size()<=0){var a,i=r.attr("name"),s=r.closest(".form-group");s.size()<=0?s=void 0:(a=s.find(".errors"),a.size()<=0&&(a=void 0));var d=r.prop("tagName").toLowerCase(),u=d,l={type:u,inputs:[r],formGroup:s,errorsBlock:a,block:o,name:i};switch(d){case"select":case"textarea":break;case"input":switch(u=r.attr("type").toLowerCase()){default:l.type=u;break;case"checkbox":u="checkbox",l.type=u,void 0!==r.attr("value")&&(l.trueValue=r.attr("value")),void 0!==r.attr("data-hex-true-value")&&(l.trueValue=r.attr("data-hex-true-value")),void 0!==r.attr("data-hex-false-value")&&(l.falseValue=r.attr("data-hex-false-value"));break;case"radio":l.type="radio"}}void 0===t[i]?t[i]=l:t[i].inputs.push(r)}}for(var c in t)if(t.hasOwnProperty(c)){var f=new hex.Control(t[c]);o.controls.push(f),o.form.controls.push(f)}};i()},e}(hex||{}),hex=function(e){"use strict";return e.Control=function(t){function n(e){return function(t,n){return"number"==typeof t[e]?t[e]-n[e]:t[e]<n[e]?-1:t[e]>n[e]?1:0}}function r(e){i.push(e);var t=h(e);for(var r in t)if(t.hasOwnProperty(r)){var o=r.match(/^data-hex-widget-(.*)$/i);if(null!==o&&void 0!==o[1]&&m(o[1],t[r]),"required"===r)p("required",t[r]);else{var d=r.match(/^data-hex-validator-(.*)$/i);null!==d&&void 0!==d[1]&&p(d[1],t[r])}}for(var u in f)f.hasOwnProperty(u)&&e.bind(u,v);l.sort(n("weight")),e.prop("disabled")&&a.disable(),e.prop("readonly")&&a.addReadonly(),e.bind("disable",function(){a.disable()}),e.bind("enable",function(){a.enable()}),s=a.getValue()}var a=this;a.type=void 0,a.valid=!0,a.name=void 0;var i=[];a.block=void 0;var o,s,d=[];a.formGroup=void 0;var u,l=[],c={},f={};a.disabled=!1,a.readonly=!1,a.hideErrors=function(){d=[],void 0!==a.formGroup&&a.formGroup.removeClass("has-error"),void 0!==o&&o.find("span").removeClass("active")},a.showErrors=function(){if(void 0!==o)for(var e in d)o.find("span.error-"+d[e]).addClass("active");void 0!==a.formGroup&&a.formGroup.addClass("has-error")},a.reset=function(){a.trigger("change"),a.hideErrors()},a.getWidgets=function(){return c},a.getInputs=function(){return i},a.enable=function(){for(var e in i)i[e].prop("disabled",!1);a.disabled=!1},a.disable=function(){for(var e in i)i[e].prop("disabled",!0);a.disabled=!0,a.valid=!0},a.addReadonly=function(){for(var e in i)i[e].prop("readonly",!0);a.readonly=!0},a.removeReadonly=function(){for(var e in i)i[e].prop("readonly",!1);a.readonly=!1};var v=function(e){if(e===!1)return a.valid;if(a.hideErrors(),!a.disabled)for(var t in l)if(l.hasOwnProperty(t)){var n=l[t],r=n.isValid(a.getValue());if(r===!1||"false"===r){d.push(n.getClassName());break}}return d.length>0?(a.valid=!1,a.showErrors()):(a.valid=!0,a.hideErrors()),void 0!==a.block.form.mainBlock&&a.block.form.mainBlock.isValid(!1),a.valid};a.isValid=function(e){return v(e)},a.trigger=function(e){for(var t=0;t<i.length;t++)i[t].trigger(e)},a.addEvent=function(e,t){for(var n=0;n<i.length;n++)i[n].bind(e,t)};var h=function(e){for(var t={},n=e[0].attributes,r=n.length,a=0;r>a;a++)t[n[a].name.toLowerCase()]=n[a].value;return t},p=function(t,n){var r={};if(t=e.utils.toCamel(t),void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),void 0!==e.validators[t]){var i=new e.validators[t](a,r),o=i.getEvents();for(var s in o)o.hasOwnProperty(s)&&(f[o[s]]=!0);l.push(i)}else console.warn('Validator "'+t+'" not loaded!')},m=function(t,n){t=e.utils.toCamel(t);var r={};void 0!==n&&""!==n&&$.extend(r,jQuery.parseJSON(n)),void 0!==e.widgets[t]?c[t]=new e.widgets[t](a,r):console.warn('Widget "'+t+'" not loaded!')};a.getValue=function(){switch(a.type){case"text":default:if(void 0!==c.date){var e=i[0].data("daterangepicker");if(void 0===e)return i[0].val();if(""===i[0].val())return!1;var t="",n="YYYY-MM-DD";if(e.timePicker===!0&&(n+=" HH:mm"),t+=e.startDate.format(n),e.singleDatePicker===!1){var r=e.endDate.format(n);t+=" - "+r}return t}return void 0!==c.fileupload||void 0!==c.filesimple?u:i[0].val();case"radio":for(var o in i)if(i.hasOwnProperty(o)&&i[o].is(":checked")===!0)return i[o].val();return!1;case"checkbox":return i[0].is(":checked")===!0?a.trueValue:a.falseValue}},a.setValue=function(e){u=e};var g=function(e){if(void 0!==e.type&&(a.type=e.type,"checkbox"===e.type&&(a.trueValue=!0,a.falseValue=!1,void 0!==e.trueValue&&(a.trueValue=e.trueValue),void 0!==e.falseValue&&(a.falseValue=e.falseValue))),void 0!==e.block&&(a.block=e.block),a.name=e.name,a.formGroup=e.formGroup,o=e.errorsBlock,void 0!==e.inputs)for(var t in e.inputs)e.inputs.hasOwnProperty(t)&&r(e.inputs[t]);a.hideErrors()};g(t)},e}(hex),hex=function(e){"use strict";return e.widgets.passwordShow=function(e){function t(){r=e.getInputs()[0],n=r.closest(".form-group").find("button.password-show"),n.bind("click",function(e){return e.preventDefault(),"password"===a?(r.attr("type","text"),n.addClass("active"),a="text"):(r.attr("type","password"),n.removeClass("active"),a="password"),r.focus(),!1})}var n,r,a="password";t()},e}(hex),hex=function(e){"use strict";return e.widgets.passwordStrength=function(e){function t(e){return o=e.length>8?1:0,s=e.match(c)?1:0,d=e.match(f)?1:0,u=e.match(v)?1:0,l=e.match(h)?1:0,o+s+d+u+l}function n(){r=e.getInputs()[0],a=r.closest(".form-group").find(".password-strength div"),r.bind("keyup change",function(){var e=r.val();a.attr("class","s-"+t(e))})}var r,a,i=this,o=0,s=0,d=0,u=0,l=0,c=new RegExp("[A-ZА-Я]"),f=new RegExp("[a-zа-я]"),v=new RegExp("[0-9]"),h=new RegExp("([!,%,&,@,#,$,^,*,?,_,~])");i.weight=0,n()},e}(hex),hex=function(e){"use strict";var t=$("html").attr("lang");if(e.utils.isEmpty(t))throw new Error("Doesn`t set lang attr in html tag");return moment.locale(t.toLowerCase()),e.widgets.date=function(t,n){function r(){a=t.getInputs()[0];var r=moment.localeData(),u=r.longDateFormat("L");void 0!==n.timePicker&&n.timePicker===!0&&(u+=" "+r.longDateFormat("LT"));var l={autoUpdateInput:!1,linkedCalendars:!1,singleDatePicker:!0,locale:{format:u,separator:" - ",applyLabel:"Готово",cancelLabel:"Отмена",fromLabel:"От",toLabel:"До",customRangeLabel:"Custom",daysOfWeek:moment.weekdaysShort(),monthNames:moment.months(),firstDay:r.firstDayOfWeek()}};void 0!==n.parentMin&&(s=$(n.parentMin).val(),e.utils.isEmpty(s)||(l.minDate=s),i=n.parentMin,delete n.parentMin),void 0!==n.parentMax&&(d=$(n.parentMax).val(),e.utils.isEmpty(d)||(l.maxDate=d),o=n.parentMax,delete n.parentMax),$.extend(l,n);var c=l.locale.format.replace(/[H]/g,"9").replace(/[m]/g,"9").replace(/[D]+/g,"d").replace(/[M]+/g,"m").replace(/[Y]+/g,"y");l.singleDatePicker===!1&&(c+=l.locale.separator+c),a.inputmask(c);var f=function(){var e=a.data("daterangepicker"),t=e.startDate.format(l.locale.format);l.singleDatePicker===!1&&(t+=l.locale.separator+e.endDate.format(l.locale.format)),a.val(t).trigger("change")};a.daterangepicker(l),a.on("apply.daterangepicker",function(){f()});var v=function(){d=$(o).val(),e.utils.isEmpty(d)?(t.disable(),a.val("").trigger("change")):(l.maxDate=d,a.daterangepicker(l),a.on("apply.daterangepicker",function(){f()}),t.enable(),e.utils.isEmpty(a.val())&&(e.utils.isEmpty(s)?(a.data("daterangepicker").setStartDate(d),a.data("daterangepicker").setEndDate(d)):(a.data("daterangepicker").setStartDate(s),a.data("daterangepicker").setEndDate(s))),f())},h=function(){s=$(i).val(),e.utils.isEmpty(s)?(t.disable(),a.val("").trigger("change")):(l.minDate=s,a.daterangepicker(l),a.on("apply.daterangepicker",function(){f()}),t.enable(),e.utils.isEmpty(a.val())&&(a.data("daterangepicker").setStartDate(s),a.data("daterangepicker").setEndDate(s)),f(),o!==!1&&v())};i!==!1&&$(i).on("change",function(){h()}),o!==!1&&$(o).on("change",function(){v()}),o!==!1&&v(),i!==!1&&h()}var a,i=!1,o=!1,s=!1,d=!1;r()},e}(hex),hex=function(e){"use strict";return e.widgets.mask=function(e,t){function n(){if(r=e.getInputs()[0],void 0===t.mask)throw new Error(r.attr("name")+" doesn`t set mask param");a=t.mask,r.inputmask(a)}var r,a;n()},e}(hex),hex=function(e){"use strict";return e.widgets.phone=function(e,t){function n(){r=e.getInputs()[0],void 0!==t.mask&&(a=t.mask),r.inputmask(a)}var r,a="+7(999)999-99-99";n()},e}(hex),hex=function(e){"use strict";return e.widgets.select2=function(t,n){function r(){a=t.getInputs()[0];var r=n.placeholder||"",o={theme:"bootstrap",allowClear:!0,placeholder:r};if(void 0!==n.url){i="ajax";var s=a.find("option[selected]");if(n.ajax={url:n.url,method:"POST",dataType:"json",delay:250,data:function(e){return{search:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.rows,pagination:{more:t.page*e.limit<e.total}}},cache:!1},delete n.url,void 0!==n.parent){var d=n.parent.selector,u=n.parent.param||"parent_id";e.utils.isEmpty($(d).val())&&(t.disable(),a.val("").trigger("change")),$(d).on("change",function(){e.utils.isEmpty($(this).val())?(t.disable(),a.val("").trigger("change")):t.enable()}),delete n.parent;var l=function(){return $(d).val()};n.ajax.data=function(e){var t={search:e.term,page:e.page};return t[u]=l,t}}}$.extend(o,n),a.select2(o),"ajax"===i&&(s.each(function(){a.append($(this))}),a.trigger("change"))}var a,i="local";r()},e}(hex),hex=function(e){"use strict";return e.widgets.filesimple=function(e){function t(){function t(t){r=t.target.files[0],e.setValue(r)}n=e.getInputs()[0],n.bind("change",t)}var n,r;t()},e}(hex),hex=function(e){"use strict";return e.widgets.fileupload=function(t,n){function r(){var e=[];for(var n in C)C[n].valid&&void 0!==C[n].id&&e.push(parseInt(C[n].id));t.setValue(e)}function a(){var e=!1;for(var t in C)if(C[t].loading===!0){e=!0;break}E.loading=e}function i(e,t){var n=y.clone();void 0!==t&&n.addClass(t),n.find("i").attr("title",e.name).html(e.name);var r=n.find(".upload-preview");return void 0!==e.url?(r.attr("href",e.url),void 0!==e.thumb&&r.html('<img src="'+e.thumb+'"/>')):r.hide(),n.get(0).outerHTML}function o(){var e="";for(var t in C)e+=i(C[t]);g.html(e),g.find("thumb").each(function(e){C[e].setElement($(this))})}function s(e){if(w){for(var t in C)C[t].remove(!0);g.find("thumb").remove(),r()}var n=new B({uid:e.uniqueIdentifier,name:e.name,loading:!0}),o=i(n,"upfile-new loading");g.append(o),n.setElement(g.find("thumb:last-child")),C.push(n),n.progress(5),a()}function d(e){for(var t=C.length,n=0;t>=n;n++)if(C[n].uid===e)return C[n];return!1}function u(e,t){var n=d(e.uniqueIdentifier);n!==!1&&n.error(t),a()}function l(e,t){var n=d(e.uniqueIdentifier);n!==!1&&n.complete(t),a()}function c(e){var t=Math.floor(e.size/100),n=Math.floor(e.sizeUploaded()/t),r=d(e.uniqueIdentifier);r!==!1&&r.progress(n)}function f(){var e=[];g.find("thumb").each(function(){var t=$(this).attr("id");for(var n in C)C[n].rid===t&&e.push(C[n])}),C=e,r()}function v(){if(h=t.getInputs()[0],b="u_"+h.attr("id")+"_",void 0!==n.types){x=[];var a=/$[\.]/;for(var i in n.types){var d=n.types[i];a.test(d)||(d="."+d),x.push(d)}}if(n.single===!0&&(w=!0),void 0!==n.limit&&(k=parseInt(n.limit),isNaN(k)&&(k=1),0===k&&(k=0),delete n.limit),void 0===n.url)throw new Error("doesnt set url paremetr on "+t.name);p=n.url;var v={target:p,singleFile:w,simultaneousUploads:5,chunkSize:262144,maxChunkRetries:void 0,allowDuplicateUploads:!1,prioritizeFirstAndLastChunk:!0,generateUniqueIdentifier:function(t){var n="file_";return n+=t.size,n+=t.name,n+=b,n=e.utils.md5(n)}};if(m=new Flow(v),y=h.closest(".form-group").find(".upload-dropzone *").first().clone(!1),h.closest(".form-group").find(".upload-dropzone *").remove(),g=h.closest(".form-group").find(".upload-dropzone"),g.on("dragenter",function(){$(this).addClass("drag")}),g.on("dragover",function(){$(this).addClass("drag")}),g.on("dragend",function(){$(this).removeClass("drag")}),g.on("drop",function(){$(this).removeClass("drag")}),g.on("mouseout",function(){$(this).removeClass("drag")}),g.on("dragleave",function(){$(this).removeClass("drag")}),1!==k){var E=dragula([g[0]],{mirrorContainer:g.closest(".form-group")[0],direction:"horizontal",copy:!1,copySortSource:!1});E.on("drop",function(){f()})}var V=h.data("hexFiles");if(void 0!==V){for(var D in V){var I=new B(V[D]);C.push(I)}o()}if(r(),m.support){var S={};void 0!==x&&(S.accept=x.join(",")),m.assignBrowse(h.closest(".form-group").find("[data-upload]")[0],!1,w,S),m.assignDrop(g[0]),m.on("fileAdded",function(e){var t=!0;return void 0!==x&&x.indexOf("."+e.getType())<0&&(t=!1),t?s(e):(s(e),u(e,'"'+e.name+'" - неверный тип файла. Разрешены файлы типа: '+x.join(", "))),t}),m.on("fileSuccess",function(e,t){t=$.parseJSON(t),l(e,t)}),m.on("fileError",function(e,t){u(e,t)}),m.on("filesSubmitted",function(){m.upload()}),m.on("fileProgress",function(e){c(e)})}}var h,p,m,g,x,y,b,k=0,w=!1,C=[],E=this;E.loading=!1;var B=function(e){function t(){var e=b;void 0!==i.id&&(e+="_"+i.id),void 0!==i.uid&&(e+="_"+i.uid),i.rid=e,o.attr("id",e)}function n(e){if(void 0!==e)for(var t in e)i.hasOwnProperty(t)&&(i[t]=e[t]);void 0===i.id&&(i.valid=!1)}var i=this;i.id=void 0,i.uid=void 0,i.thumb=void 0,i.url=void 0,i.name=void 0,i.valid=!0,i.rid=0,i.loading=!1;var o;i.setElement=function(e){o=e,o.on("click","remove",function(e){return e.preventDefault(),i.remove(),!1}),t()},i.progress=function(e){i.valid=!1,o.find("p").show().css("width",e+"%")},i.complete=function(e){i.valid=!0,i.loading=!1,n(e),o.removeClass("loading");var t=o.find(".upload-preview");t.attr("href",i.url),t.show(),void 0!==i.thumb&&t.html('<img src="'+i.thumb+'"/>'),o.find("p").hide(),i.loading=!1,r()},i.remove=function(e){i.valid=!1,i.loading=!1;var t=C.indexOf(i);t>=0&&(E.uploaderRemoveFile(i.uid),C.splice(t,1)),e===!0?o.remove():o.fadeOut(function(){o.remove()}),a(),r()},i.error=function(e){i.valid=!1,i.loading=!1,o.find("p").hide(),o.removeClass("loading"),e="! Ошибка:<br/>"+e,o.find(".frame").html('<div class="upload-error">'+e+"</div>"),o.addClass("upfile-error"),o.removeClass("upfile-new");var t=C.indexOf(i);t>=0&&(E.uploaderRemoveFile(i.uid),C.splice(t,1))},n(e)};E.uploaderRemoveFile=function(e){var t=m.files;for(var n in t)if(t[n].uniqueIdentifier===e){m.removeFile(t[n]);break}},v()},e}(hex),hex=function(e){"use strict";return e.validators.required=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events)}var a=this,i=["blur","change","keyup"];a.weight=0;var o="required";a.getClassName=function(){return o},a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(t){return!e.utils.isEmpty(t)},r()},e}(hex),hex=function(e){"use strict";return e.validators.email=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events)}var a=this,i="email";a.getClassName=function(){return i};var o=["change","keyup"],s=/^\S+[@]\S+\.\S{2,10}$/i;a.weight=1,a.setEvents=function(e){o=e},a.getEvents=function(){return o},a.isValid=function(t){return e.utils.isEmpty(t)?!0:s.test(t)},r()},e}(hex),hex=function(e){"use strict";return e.validators.unique=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events),void 0!==t.url&&(i=t.url)}var r=this,a="unique";r.getClassName=function(){return a};var i,o=!1,s=!1,d=["change","keyup","blur"];r.weight=5,r.setEvents=function(e){d=e},r.getEvents=function(){return d},r.isValid=function(e){if(s!==!1&&s.abort(),o!==e){s=$.ajax({url:i,data:{value:e},method:"POST",async:!1});var t=s.responseText;return o="true"===t?e:!1,t}return!0},n()},e}(hex),hex=function(e){"use strict";return e.validators.stringLength=function(e,t){function n(){void 0!==t.min&&(r=t.min),void 0!==t.max&&(a=t.max),void 0!==t.events&&i.setEvents(t.events)}var r,a,i=this,o="string-length";i.getClassName=function(){return o};var s=["change","keyup","blur"];i.weight=3,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(e){var t=e.length;return void 0!==r&&r>t?(o="string-length-min",!1):void 0!==a&&t>a?(o="string-length-max",!1):!0},n()},e}(hex),hex=function(e){"use strict";return e.validators.passwordConfirm=e.validators.confirm=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events),void 0!==t.password&&(o=$(t.password))}var r=this,a="password-confirm";r.getClassName=function(){return a};var i=["change","keyup","blur"];r.weight=4;var o;r.setEvents=function(e){i=e},r.getEvents=function(){return i},r.isValid=function(e){return o.val()===e},n()},e}(hex),hex=function(e){"use strict";return e.validators.mask=function(t,n){function r(){void 0!==n.events&&i.setEvents(n.events),a=t.getInputs()[0]}var a,i=this,o="mask",s=["blur"];i.getClassName=function(){return o},i.weight=4,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.phone=function(t,n){function r(){void 0!==n.events&&i.setEvents(n.events),a=t.getInputs()[0]}var a,i=this,o="phone",s=["blur"];i.getClassName=function(){return o},i.weight=4,i.setEvents=function(e){s=e},i.getEvents=function(){return s},i.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=a.inputmask("option","mask");return Inputmask.isValid(a.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.date=function(t,n){function r(){void 0!==n.events&&a.setEvents(n.events),o=t.getInputs()[0]}var a=this,i=["change","keyup","blur"];a.weight=3;var o,s="date";a.getClassName=function(){return s},a.setEvents=function(e){i=e},a.getEvents=function(){return i},a.isValid=function(t){if(e.utils.isEmpty(t))return!0;var n=o.inputmask("option","mask");return Inputmask.isValid(o.val(),{alias:n})},r()},e}(hex),hex=function(e){"use strict";return e.validators.fileupload=function(e,t){function n(){void 0!==t.events&&r.setEvents(t.events)}var r=this,a="fileupload";r.getClassName=function(){return a};var i=[];r.setEvents=function(e){i=e},r.getEvents=function(){return i},r.isValid=function(){var t=e.getWidgets().fileupload;return void 0===t?!0:t.loading!==!0},n()},e}(hex),hex=function(e){"use strict";function t(t){function n(e){var t=o.mainBlock.findBlockById(e);if(t===!1)return!1;for(var n in t.controls){var r=t.controls[n],a=o.findControlByName(r.name);a!==!1&&o.controls.splice(o.controls.indexOf(a),1)}if(t.controls=[],t.element.remove(),void 0!==t.parent)for(var i in t.parent.childBlocks)t.parent.childBlocks[i]===t&&t.parent.childBlocks.splice(i,1);o.mainBlock.isValid(!1)}function r(e){function t(){r.isValid(!1);var t=s.getValue(),n=!1;null===t||t===!1||void 0===t||""===t||$.isArray(t)&&0===t.length?n=!1:("string"==typeof t&&t===i&&(n=!0),"object"==typeof t&&t.indexOf(i)>=0&&(n=!0)),n?(e.show(),e.find('input[type!="submit"],select,textarea').trigger("enable")):(e.hide(),e.find('input[type!="submit"],select,textarea').trigger("disable"))}if(e.parents('[data-hex-multy-item="$"]').size()>0)return!1;var n=e.closest("[data-hex-block]").attr("id"),r=o.mainBlock.findBlockById(n),a=e.data("hexDisabled"),i=a.value,s=o.findControlByName(a.control);if(void 0===s)throw new Error('Control "'+a.control+'" not found');s.addEvent("change",t),s.trigger("change")}function a(e){return e.replace("-","").toUpperCase()}function i(e){function t(e,t){o.hexBind(e,{"@index":t})}function a(){if(u===!1){var t=e.find("[data-hex-multy-item]");t.size()<=1?e.find("[data-hex-multy-remove]").attr("disabled","disabled"):e.find("[data-hex-multy-remove]").removeAttr("disabled")}}var i,s,d=e.data("hex-multy"),u=!1;void 0!==d.allow_empty&&d.allow_empty===!0&&(u=!0),e.find("[data-hex-multy-tabs]").size()>0&&(i=e.find("[data-hex-multy-tabs]"),s=i.find('[data-hex-multy-tab="$"]').clone(!1),i.find('[data-hex-multy-tab="$"]').remove());var l=e.find('[data-hex-multy-item="$"]'),c=l.clone(!1);l.remove(),e.on("click","[data-hex-multy-add]",function(){var n=e.find("[data-hex-multy-item]"),d=n.size(),u=c.clone(!1);u.find("[data-hex-multy-hide]").remove(),u.find("[data-hex-multy-attr]").each(function(){var e=$(this),t=e.data("hex-multy-attr");if(void 0!==t.add&&$.each(t.add,function(t,n){for(var r in n)e.attr(r,n[r])}),void 0!==t.remove)for(var n in t.remove)e.removeAttr(t.remove[n])});var l=e.find("[data-hex-multy-items]").closest("[data-hex-block]").attr("id"),f=o.mainBlock.findBlockById(l);if(void 0!==i){var v=s.clone(!1);e.find("[data-hex-multy-tab]:last").size()>0?v.insertAfter(e.find("[data-hex-multy-tab]:last")):i.prepend(v),t(v,d)}t(u,d),u.appendTo(e.find("[data-hex-multy-items]")),f.addBlock(u),void 0!==i&&$('a[href="#'+u.attr("id")+'"]').trigger("click"),u.find("[data-hex-disabled]").size()>0&&u.find("[data-hex-disabled]").each(function(){r($(this))}),a()}),e.on("click","[data-hex-multy-remove]",function(){var r=$(this).closest("[data-hex-multy-item]"),s=r.data("hexMultyItem");r.fadeOut(500,function(){n(r.attr("id"));var d=e.find("[data-hex-multy-item]");d.each(function(){$(this).data("hexMultyItem")>s&&t($(this),$(this).data("hexMultyItem")-1)}),void 0!==i&&(i.find('[data-hex-multy-tab="'+s+'"]').remove(),i.find("[data-hex-multy-tab]").each(function(){$(this).data("hexMultyTab")>s&&t($(this),$(this).data("hexMultyTab")-1)}),i.find("[data-hex-multy-tab="+s+"]").size()>0?i.find("[data-hex-multy-tab="+s+"]").find('a[role="tab"]').trigger("click"):i.find("[data-hex-multy-tab]:nth-child("+s+")").size()>0&&i.find("[data-hex-multy-tab]:nth-child("+s+")").find('a[role="tab"]').trigger("click")),a(),console.log(o)})}),a()}var o=this;o.controls=[],o.errorText="Не удалось сохранить форму, попробуйте обновить страницу",o.invalidText="Форма содержит ошибки";var s=$("#"+t),d={};o.mainBlock=void 0;var u=function(e){this.type=e,this.stoped=!1,this.stop=function(){this.stoped=!0}};o.findControlByName=function(e){for(var t in o.controls)if(o.controls[t].name===e)return o.controls[t];return!1},o.on=function(e,t){void 0===d[e]&&(d[e]=[]),d[e].indexOf(t)<0&&d[e].push(t)},o.off=function(e,t){void 0!==d[e]&&d[e].splice(d[e].indexOf(t),1)},o.fire=function(e,t){if(void 0!==d[e]){var n=new u(e);for(var r in d[e]){var a=d[e][r];a(t,n)}return!n.stoped}return!0},o.getHandlers=function(){return d};var l=function(){var e={};for(var t in o.controls)if(o.controls.hasOwnProperty(t)&&o.controls[t].disabled===!1){var n=o.controls[t].name,r=o.controls[t].getValue();null===r||$.isArray(r)&&0===r.length?r="":e[n]=r}return e},c=function(e){var t=o.fire("beforeReset",{values:o.getValues()});t?window.setTimeout(function(){for(var e in o.controls)o.controls.hasOwnProperty(e)&&o.controls[e].reset();s.find(".has-error").removeClass("has-error"),s.find(".alerts .alert").remove()},1):e.preventDefault(),o.fire("afterReset",{})},f=function(){s.find(".has-error").removeClass("has-error"),s.find(".alerts div").remove()},v=function(e){e.preventDefault(),e.stopPropagation();var t=o.mainBlock.isValid();if(t===!0){f();var n=l(),r=o.fire("beforeSubmit",{values:n});if(r){o.loaderShow();var a=s.attr("action"),i=s.find("button[type=submit]:focus");i.size()>0&&void 0!==i.attr("data-action")&&(a=i.attr("data-action"));var d="POST";void 0!==s.attr("method")&&(d=s.attr("method"));var u=new FormData;$.each(n,function(e,t){if($.isArray(t)||$.isPlainObject(t))for(var n in t)null!==t[n]&&t[n]!==!1&&void 0!==t[n]&&u.append(e,t[n]);else u.append(e,t)}),$.ajax({url:a,data:u,type:d,dataType:"json",processData:!1,contentType:!1,success:function(e){var t=o.fire("afterSubmit",e);t&&window.setTimeout(function(){if(e.success===!0?(f(),void 0!==e.reload?e.reload===!0?window.location.href=window.location.href:window.location.href=e.reload:(o.loaderHide(),void 0!==e.newtab&&$(window).open(e.newtab,"_self"))):o.loaderHide(),void 0!==e.alerts){for(var t in e.alerts){var n=e.alerts[t];s.find(".alerts").append($("<div>").addClass("alert alert-"+n.type).html(n.text))}o.loaderHide()}},1)},error:function(){o.loaderHide(),s.find(".alerts").append($("<div>").addClass("alert alert-danger").html(o.errorText))}})}}else s.find(".alerts div").remove(),s.find(".alerts").append($("<div>").addClass("alert alert-danger").html(o.invalidText));return!1};o.loaderShow=function(){s.find(".loader").show()},o.loaderHide=function(){s.find(".loader").hide()},o.submit=function(){v()},o.getValues=function(){return l()},o.hexBind=function(e,t){function n(e){var t=e.split(""),n=[],r=[],a=0,i=!0;n[a]="";for(var o=0;o<t.length;o++)isNaN(parseInt(t[o]))&&"."!==t[o]&&!i?(r[a]=t[o],a++,n[a]="",i=!0):(n[a]+=t[o],i=!1);e=parseFloat(n[0]);for(var s=0;s<r.length;s++){var d=parseFloat(n[s+1]);switch(r[s]){case"+":e+=d;break;case"-":e-=d;break;case"*":e*=d;break;case"/":e/=d}}return e}function r(e){if("object"==typeof e)for(var a in e)e[a]=r(e[a]);else{for(var i in t)e=e.replace(new RegExp(i,"g"),t[i]);/\%/.test(e)&&(e=e.replace(/\%(.*?)\%/g,function(e){return n(e.replace(/\%/g,""))}))}return e}var i=[];i.push(e),e.find("[data-hex-bind]").each(function(){i.push($(this))});for(var s in i){var d=i[s].data("hexBind");for(var u in d){var l=r(d[u]);if("html"!==u){if(/^data/.test(u)){var c=u.replace(/^data-/,"");c=c.replace(/(\-[a-z])/g,a),i[s].data(c,l)}if("name"===u){var f=i[s].attr("name"),v=o.findControlByName(f);v!==!1&&(v.name=l)}if("id"===u&&0>=s){var h=o.mainBlock.findBlockById(i[s].attr("id"));h!==!1?h.id=l:console.log("block not found id:"+i[s].attr("id")),console.log(h),console.log("=========change block.id=========")}"object"==typeof l?i[s].attr(u,JSON.stringify(l)):i[s].attr(u,l)}else i[s].html(l)}}};var h=function(){s.addClass("loader-container").append('<div class="loader"></div>'),s.attr("data-hex-block",""),$(document).on("submit","#"+t,v),$(document).on("reset","#"+t,c),0===s.find(".loader").size()&&s.append('<div class="loader"></div>'),o.mainBlock=new e.Block(s,o),s.find("[data-hex-multy]").size()>0&&s.find("[data-hex-multy]").each(function(){i($(this))}),s.find("[data-hex-disabled]").size()>0&&s.find("[data-hex-disabled]").each(function(){r($(this))})};return h(),o}var n={};return e.form=function(e){if(void 0!==e)return void 0===n[e]&&(n[e]=new t(e)),n[e];var r=$("form.hex-form");return r.each(function(){var e=$(this).attr("id");if(void 0===e)throw new Error("Form dont have id attr");void 0===n[e]&&(n[e]=new t(e))}),n},$(document).ready(function(){e.form()}),e}(hex);